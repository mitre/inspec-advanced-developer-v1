<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>InSpec Advanced Developer Course | MITRE InSpec Advanced Developer Course</title>
    <meta name="description" content="The MITRE InSpec Team&#39;s Advanced course for InSpec Profile and Resource Development">
    
    
    <link rel="preload" href="/assets/css/0.styles.d7d6c04a.css" as="style"><link rel="preload" href="/assets/js/app.58b316d7.js" as="script"><link rel="preload" href="/assets/js/2.0a3e1e4e.js" as="script"><link rel="preload" href="/assets/js/3.226df228.js" as="script"><link rel="prefetch" href="/assets/js/10.5f891da1.js"><link rel="prefetch" href="/assets/js/11.e7643235.js"><link rel="prefetch" href="/assets/js/12.57d30c67.js"><link rel="prefetch" href="/assets/js/13.a72d706a.js"><link rel="prefetch" href="/assets/js/14.9e1c80ba.js"><link rel="prefetch" href="/assets/js/15.d9766f80.js"><link rel="prefetch" href="/assets/js/4.6165c32a.js"><link rel="prefetch" href="/assets/js/5.265536c6.js"><link rel="prefetch" href="/assets/js/6.497c71a2.js"><link rel="prefetch" href="/assets/js/7.44606cfd.js"><link rel="prefetch" href="/assets/js/8.b2612c93.js"><link rel="prefetch" href="/assets/js/9.33b04b8f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d7d6c04a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-exact-active router-link-active"><!----> <span class="site-name">MITRE InSpec Advanced Developer Course</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-exact-active router-link-active">Course</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Install</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/installation/LinuxInstall.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/installation/MacInstall.html" class="nav-link">Mac</a></li><li class="dropdown-item"><!----> <a href="/installation/WindowsInstall.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/installation/vagrant_install.html" class="nav-link">Vagrant Install</a></li></ul></div></div><div class="nav-item"><a href="/resources/" class="nav-link">Resources</a></div><div class="nav-item"><a href="/contact.html" class="nav-link">Contact</a></div> <a href="https://github.com/mitre/inspec-advanced-developer" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-exact-active router-link-active">Course</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Install</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/installation/LinuxInstall.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/installation/MacInstall.html" class="nav-link">Mac</a></li><li class="dropdown-item"><!----> <a href="/installation/WindowsInstall.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/installation/vagrant_install.html" class="nav-link">Vagrant Install</a></li></ul></div></div><div class="nav-item"><a href="/resources/" class="nav-link">Resources</a></div><div class="nav-item"><a href="/contact.html" class="nav-link">Contact</a></div> <a href="https://github.com/mitre/inspec-advanced-developer" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>InSpec Advanced Developer Course</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/#_1-about-inspec" class="sidebar-link">1. About InSpec</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#_1-1-orchestration-configuration-management-validation-to-deployment" class="sidebar-link">1.1. Orchestration, Configuration Management, Validation to Deployment</a></li><li class="sidebar-sub-header"><a href="/#_1-2-automating-security-validation-using-inspec" class="sidebar-link">1.2. Automating Security Validation Using InSpec</a></li><li class="sidebar-sub-header"><a href="/#_1-3-processing-inspec-results" class="sidebar-link">1.3. Processing InSpec Results</a></li></ul></li><li><a href="/#_2-course-overview" class="sidebar-link">2. Course Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#_2-1-inspec-profile-structure" class="sidebar-link">2.1. InSpec Profile Structure</a></li><li class="sidebar-sub-header"><a href="/#_2-2-inspec-controls-structure" class="sidebar-link">2.2. InSpec Controls Structure</a></li><li class="sidebar-sub-header"><a href="/#_2-3-inspec-results" class="sidebar-link">2.3. InSpec Results</a></li><li class="sidebar-sub-header"><a href="/#_2-4-tooling-and-reporting" class="sidebar-link">2.4. Tooling and Reporting</a></li><li class="sidebar-sub-header"><a href="/#_2-5-inspec-resources" class="sidebar-link">2.5. InSpec Resources</a></li></ul></li><li><a href="/#_3-recap-of-an-inspec-profile" class="sidebar-link">3. Recap of an InSpec profile</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#_3-1-understanding-the-profile-structure" class="sidebar-link">3.1. Understanding the profile structure</a></li><li class="sidebar-sub-header"><a href="/#_3-2-understand-a-control-s-structure" class="sidebar-link">3.2. Understand a control's structure</a></li><li class="sidebar-sub-header"><a href="/#_3-3-understand-a-describe-block-s-structure" class="sidebar-link">3.3. Understand a describe block's structure</a></li></ul></li><li><a href="/#_4-advanced-techniques-in-profile-development" class="sidebar-link">4. Advanced techniques in profile development</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#_4-1-rspec-explicit-subject" class="sidebar-link">4.1. rspec Explicit Subject</a></li><li class="sidebar-sub-header"><a href="/#_4-2-looping-file-structure" class="sidebar-link">4.2. looping file structure</a></li><li class="sidebar-sub-header"><a href="/#_4-3-checking-password-encryption" class="sidebar-link">4.3. Checking password encryption</a></li></ul></li><li><a href="/#_5-exploring-inspec-resources" class="sidebar-link">5. Exploring InSpec Resources</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#_5-1-resource-overview" class="sidebar-link">5.1. Resource Overview</a></li><li class="sidebar-sub-header"><a href="/#_5-2-resource-structure" class="sidebar-link">5.2. Resource Structure</a></li></ul></li><li><a href="/#_6-explore-the-basics-of-a-resource" class="sidebar-link">6. Explore the basics of a resource</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#_6-1-class" class="sidebar-link">6.1. class</a></li><li class="sidebar-sub-header"><a href="/#_6-2-name" class="sidebar-link">6.2. name</a></li><li class="sidebar-sub-header"><a href="/#_6-3-supports" class="sidebar-link">6.3. supports</a></li><li class="sidebar-sub-header"><a href="/#_6-4-desc-examples" class="sidebar-link">6.4. desc &amp; examples</a></li><li class="sidebar-sub-header"><a href="/#_6-5-initialize-method" class="sidebar-link">6.5. initialize method</a></li><li class="sidebar-sub-header"><a href="/#_6-6-functionality-methods" class="sidebar-link">6.6. functionality methods</a></li></ul></li><li><a href="/#_7-local-resource-vs-builtin-resource" class="sidebar-link">7. Local Resource vs Builtin Resource</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#_7-1-local-resource" class="sidebar-link">7.1. Local Resource</a></li><li class="sidebar-sub-header"><a href="/#_7-2-builtin-inspec-resource" class="sidebar-link">7.2. Builtin InSpec Resource</a></li></ul></li><li><a href="/#_8-dissecting-resources" class="sidebar-link">8. Dissecting Resources</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#_8-1-nginx" class="sidebar-link">8.1. NGINX</a></li><li class="sidebar-sub-header"><a href="/#_8-2-file" class="sidebar-link">8.2. File</a></li><li class="sidebar-sub-header"><a href="/#_8-3-directory" class="sidebar-link">8.3. Directory</a></li><li class="sidebar-sub-header"><a href="/#_8-4-command" class="sidebar-link">8.4. command</a></li><li class="sidebar-sub-header"><a href="/#_8-5-docker" class="sidebar-link">8.5. Docker</a></li></ul></li><li><a href="/#_9-profile-resource-exercise" class="sidebar-link">9. Profile &amp; Resource exercise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#_9-1-create-new-profile" class="sidebar-link">9.1. Create new profile</a></li><li class="sidebar-sub-header"><a href="/#_9-2-develop-controls-to-test-run-controls" class="sidebar-link">9.2. Develop controls to test / run controls</a></li></ul></li><li><a href="/#_10-develop-resources-to-take-over-above-controls" class="sidebar-link">10. Develop resources to take over above controls</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#_10-1-rewrite-first-test" class="sidebar-link">10.1. Rewrite first test</a></li><li class="sidebar-sub-header"><a href="/#_10-2-develop-git-resources" class="sidebar-link">10.2. Develop git resources</a></li><li class="sidebar-sub-header"><a href="/#_10-3-develop-docker-resources" class="sidebar-link">10.3. Develop docker resources</a></li><li class="sidebar-sub-header"><a href="/#_10-4-rewrite-tests-and-run-controls" class="sidebar-link">10.4. Rewrite tests and run controls</a></li></ul></li><li><a href="/#_11-resource-development-exercise" class="sidebar-link">11. Resource Development exercise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#_11-1-what-the-resource-should-do" class="sidebar-link">11.1. What the resource should do</a></li></ul></li><li><a href="/#_12-day-2-exercise-developing-your-own-resources" class="sidebar-link">12. DAY 2: Exercise developing your own resources.</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/#_13-day-3-pushing-your-resource-up-to-inspec" class="sidebar-link">13. DAY 3: Pushing your resource up to inspec</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/#_14-day-3-update-a-few-resources-that-were-previously-built-and-show-the-process-for-moving-that-resource-to-be-put-in-inspec" class="sidebar-link">14. DAY 3: Update a few resources that were previously built and show the process for moving that resource to be put in inspec</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/#_15-using-what-you-ve-learned" class="sidebar-link">15. Using what you've learned</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/#_16-additional-resources" class="sidebar-link">16. Additional Resources</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#_16-1-security-guidance" class="sidebar-link">16.1 Security Guidance</a></li><li class="sidebar-sub-header"><a href="/#_16-2-inspec-documentation" class="sidebar-link">16.2 InSpec Documentation</a></li><li class="sidebar-sub-header"><a href="/#_16-3-additional-tutorials" class="sidebar-link">16.3 Additional Tutorials</a></li><li class="sidebar-sub-header"><a href="/#_16-4-mitre-inspec" class="sidebar-link">16.4 MITRE InSpec</a></li><li class="sidebar-sub-header"><a href="/#_16-5-rspec-documentation" class="sidebar-link">16.5. rspec documentation</a></li><li class="sidebar-sub-header"><a href="/#_16-6-slack" class="sidebar-link">16.6. Slack</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="inspec-advanced-developer-course"><a href="#inspec-advanced-developer-course" aria-hidden="true" class="header-anchor">#</a> InSpec Advanced Developer Course</h1> <h2 id="_1-about-inspec"><a href="#_1-about-inspec" aria-hidden="true" class="header-anchor">#</a> 1. About InSpec</h2> <ul><li>InSpec is an open-source, community-developed  compliance validation framework</li> <li>Provides a mechanism for defining machine-readable compliance and security requirements</li> <li>Easy to create, validate, and read content</li> <li>Cross-platform (Windows, Linux, Mac)</li> <li>Agnostic to other DevOps tools and techniques</li> <li>Integrates into multiple CM tools</li></ul> <h3 id="_1-1-orchestration-configuration-management-validation-to-deployment"><a href="#_1-1-orchestration-configuration-management-validation-to-deployment" aria-hidden="true" class="header-anchor">#</a> 1.1. Orchestration, Configuration Management, Validation to Deployment</h3> <p>InSpec operates with most orchestration and CM tools found in the DevOps pipeline implementations
<img src="/assets/img/InSpec_Orchestration.49064ca9.png" alt="Alt text" title="InSpec Orchestration"></p> <hr> <h3 id="_1-2-automating-security-validation-using-inspec"><a href="#_1-2-automating-security-validation-using-inspec" aria-hidden="true" class="header-anchor">#</a> 1.2. Automating Security Validation Using InSpec</h3> <p><img src="/assets/img/Automating_Security_Validation.7b5e7956.png" alt="Alt text" title="Automating Security Validation"></p> <hr> <h3 id="_1-3-processing-inspec-results"><a href="#_1-3-processing-inspec-results" aria-hidden="true" class="header-anchor">#</a> 1.3. Processing InSpec Results</h3> <p><img src="/assets/img/Processing_InSpec_Results.1a05435d.png" alt="Alt text" title="Processing InSpec Results"></p> <h2 id="_2-course-overview"><a href="#_2-course-overview" aria-hidden="true" class="header-anchor">#</a> 2. Course Overview</h2> <h3 id="_2-1-inspec-profile-structure"><a href="#_2-1-inspec-profile-structure" aria-hidden="true" class="header-anchor">#</a> 2.1. InSpec Profile Structure</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ tree nginx
      nginx
      └── profile
          ├── README.md
          ├── attributes.rb
          ├── controls
          │   ├── header_size.rb
          │   └──  ssl_certification.rb
          ├── inspec.yml
          └── libraries
              └── nginx_helper.rb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><hr> <h3 id="_2-2-inspec-controls-structure"><a href="#_2-2-inspec-controls-structure" aria-hidden="true" class="header-anchor">#</a> 2.2. InSpec Controls Structure</h3> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>control <span class="token string">&quot;V-13727&quot;</span> <span class="token keyword">do</span>
  title <span class="token string">&quot;The worker_processes StartServers directive must be set properly.&quot;</span>

  desc &quot;<span class="token constant">These</span> requirements are set to mitigate the effects of several types of
  denial of service attacks<span class="token punctuation">.</span> <span class="token constant">Although</span> there is some latitude concerning the
  settings themselves<span class="token punctuation">,</span> the requirements attempt to provide reasonable limits
  <span class="token keyword">for</span> the protection of the web server<span class="token punctuation">.</span> <span class="token constant">If</span> necessary<span class="token punctuation">,</span> these limits can be
  adjusted to accommodate the operational requirement of a given system<span class="token punctuation">.</span>&quot;

  impact <span class="token number">0.5</span>
  tag <span class="token string">&quot;severity&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;medium&quot;</span>
  tag <span class="token string">&quot;gtitle&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;WA000-WWA026&quot;</span>
  tag <span class="token string">&quot;gid&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;V-13727&quot;</span>
  tag <span class="token string">&quot;rid&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;SV-36645r2_rule&quot;</span>
  tag <span class="token string">&quot;stig_id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;WA000-WWA026 A22&quot;</span>
  tag <span class="token string">&quot;nist&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CM-6&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Rev_4&quot;</span><span class="token punctuation">]</span>

  tag <span class="token string">&quot;check&quot;</span><span class="token punctuation">:</span> &quot;<span class="token constant">To</span> view the worker_processes directive value enter the
  following command<span class="token punctuation">:</span>
  grep <span class="token string">&quot;&quot;</span>worker_processes<span class="token string">&quot;&quot;</span> on the nginx<span class="token punctuation">.</span>conf file <span class="token keyword">and</span> any separate included
  configuration files
  <span class="token constant">If</span> the value of <span class="token string">&quot;&quot;</span>worker_processes<span class="token string">&quot;&quot;</span> is <span class="token keyword">not</span> set to auto <span class="token keyword">or</span> explicitly set<span class="token punctuation">,</span>
  this is a finding<span class="token punctuation">:</span>
  worker_processes   auto<span class="token punctuation">;</span>
  worker_processes defines the number of worker processes<span class="token punctuation">.</span> <span class="token constant">The</span> optimal value
  depends on many factors including <span class="token punctuation">(</span>but <span class="token keyword">not</span> limited to<span class="token punctuation">)</span> the number of <span class="token constant">CPU</span>
  cores<span class="token punctuation">,</span> the number of hard disk drives that store data<span class="token punctuation">,</span> <span class="token keyword">and</span> load pattern<span class="token punctuation">.</span> <span class="token constant">When</span>
  one is <span class="token keyword">in</span> doubt<span class="token punctuation">,</span> setting it to the number of available <span class="token constant">CPU</span> cores would be a
  good start <span class="token punctuation">(</span>the value “auto” will try to autodetect it<span class="token punctuation">)</span><span class="token punctuation">.</span>&quot;

  tag <span class="token string">&quot;fix&quot;</span><span class="token punctuation">:</span> &quot;<span class="token constant">Edit</span> the configuration file <span class="token keyword">and</span> set the value of
  <span class="token string">&quot;&quot;</span>worker_processes<span class="token string">&quot;&quot;</span> to the value of auto <span class="token keyword">or</span> a value of <span class="token number">1</span> <span class="token keyword">or</span> higher<span class="token punctuation">:</span>
  worker_processes auto<span class="token punctuation">;</span>&quot;

  describe nginx_conf<span class="token punctuation">(</span><span class="token constant">NGINX_CONF_FILE</span><span class="token punctuation">)</span><span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">'worker_processes'</span><span class="token punctuation">]</span> <span class="token keyword">do</span>
    it <span class="token punctuation">{</span> should cmp <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'auto'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="_2-3-inspec-results"><a href="#_2-3-inspec-results" aria-hidden="true" class="header-anchor">#</a> 2.3. InSpec Results</h3> <h4 id="_2-3-1-failure"><a href="#_2-3-1-failure" aria-hidden="true" class="header-anchor">#</a> 2.3.1. Failure</h4> <p><img src="/assets/img/InSpec_Failure.dd02fb0c.png" alt="Alt text" title="InSpec Failure"></p> <h4 id="_2-3-2-pass"><a href="#_2-3-2-pass" aria-hidden="true" class="header-anchor">#</a> 2.3.2. Pass</h4> <p><img src="/assets/img/InSpec_Pass.226372a3.png" alt="Alt text" title="InSpec Pass"></p> <h4 id="_2-3-3-multiple-controls"><a href="#_2-3-3-multiple-controls" aria-hidden="true" class="header-anchor">#</a> 2.3.3. Multiple Controls</h4> <p><img src="/assets/img/InSpec_Multiple_Controls.0721ae73.png" alt="Alt text" title="InSpec Multiple Controls"></p> <h3 id="_2-4-tooling-and-reporting"><a href="#_2-4-tooling-and-reporting" aria-hidden="true" class="header-anchor">#</a> 2.4. Tooling and Reporting</h3> <p><img src="/assets/img/Tooling_Reporting.689428af.png" alt="Alt text" title="Tooling Reporting"></p> <h3 id="_2-5-inspec-resources"><a href="#_2-5-inspec-resources" aria-hidden="true" class="header-anchor">#</a> 2.5. InSpec Resources</h3> <p>PLACEHOLDER
<img src="/assets/img/InSpec_Pass.226372a3.png" alt="Alt text" title="InSpec Resource example"></p> <h2 id="_3-recap-of-an-inspec-profile"><a href="#_3-recap-of-an-inspec-profile" aria-hidden="true" class="header-anchor">#</a> 3. Recap of an InSpec profile</h2> <p>Let's start by creating a profile that will contain NGINX tests.</p> <p>Start by moving to the /root directory.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">cd</span> ~
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Next, create an InSpec profile named my_nginx.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>inspec init profile my_nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The terminal output should look like the following:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ inspec init profile my_nginx
Create new profile at /root/my_nginx
 * Create directory controls
 * Create <span class="token function">file</span> controls/example.rb
 * Create <span class="token function">file</span> inspec.yml
 * Create directory libraries
 * Create <span class="token function">file</span> README.md
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_3-1-understanding-the-profile-structure"><a href="#_3-1-understanding-the-profile-structure" aria-hidden="true" class="header-anchor">#</a> 3.1. Understanding the profile structure</h3> <p>Let's take a look at how the profile is structured. We'll start with how a profile's files are structured and then move to what makes up an InSpec control.</p> <p>First, run <code>tree</code> to see what's in the <code>my_nginx</code> profile.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ tree my_nginx
      my_nginx
      ├── README.md
      ├── controls
      │   └── example.rb
      ├── inspec.yml
      └── libraries

      2 directories, 3 files
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Here's the role of each component.</p> <ul><li><code>README.md</code> provides documentation about the profile, including what it covers and how to run it.</li> <li>The <code>controls</code> directory contains files which implement the InSpec tests.</li> <li><code>inspec.yml</code> provides metadata, or information, about the profile. Metadata includes the profile's description, author, copyright, and version.</li> <li>The <code>libraries</code> directory contains resource extensions. A resource extension enables you to <a href="https://www.inspec.io/docs/reference/dsl_resource/" target="_blank" rel="noopener noreferrer">define your own resource types<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. You won't work with resource extensions in this module.</li></ul> <h3 id="_3-2-understand-a-control-s-structure"><a href="#_3-2-understand-a-control-s-structure" aria-hidden="true" class="header-anchor">#</a> 3.2. Understand a control's structure</h3> <p>Let's take a look at the default control file, <code>controls/example.rb</code>.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>title <span class="token string">'sample section'</span>

<span class="token comment"># you can also use plain tests</span>
describe file<span class="token punctuation">(</span><span class="token string">'/tmp'</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
  it <span class="token punctuation">{</span> should be_directory <span class="token punctuation">}</span>
<span class="token keyword">end</span>

<span class="token comment"># you add controls here</span>
control <span class="token string">'tmp-1.0'</span> <span class="token keyword">do</span>                        <span class="token comment"># A unique ID for this control</span>
  impact <span class="token number">0.7</span>                                <span class="token comment"># The criticality, if this control fails.</span>
  title <span class="token string">'Create /tmp directory'</span>             <span class="token comment"># A human-readable title</span>
  desc <span class="token string">'An optional description...'</span>
  describe file<span class="token punctuation">(</span><span class="token string">'/tmp'</span><span class="token punctuation">)</span> <span class="token keyword">do</span>                  <span class="token comment"># The actual test</span>
    it <span class="token punctuation">{</span> should be_directory <span class="token punctuation">}</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Tip for developing profiles</p> <p>When creating new profiles use the existing example file as a template</p></div> <p>This example shows two tests. Both tests check for the existence of the <code>/tmp</code> directory. The second test provides additional information about the test. Let's break down each component.</p> <ul><li><code>control</code> (line 12) is followed by the control's name. Each control in a profile has a unique name.</li> <li><code>impact</code> (line 13) measures the relative importance of the test and must be a value between 0.0 and 1.0.</li> <li><code>title</code> (line 14) defines the control's purpose.</li> <li><code>desc</code> (line 15) provides a more complete description of what the control checks for.</li> <li><code>describe</code> (lines 16 — 18) defines the test. Here, the test checks for the existence of the <code>/tmp</code> directory.</li></ul> <p>In Ruby, the <code>do</code> and <code>end</code> keywords define a <code>block</code>. An InSpec control always contains at least one <code>describe</code> block. However, a control can contain many <code>describe</code> blocks.</p> <div class="tip custom-block"><p class="custom-block-title">More information on a block</p> <p><a href="http://ruby-for-beginners.rubymonstas.org/blocks.html" target="_blank" rel="noopener noreferrer">block<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h3 id="_3-3-understand-a-describe-block-s-structure"><a href="#_3-3-understand-a-describe-block-s-structure" aria-hidden="true" class="header-anchor">#</a> 3.3. Understand a describe block's structure</h3> <p>As with many test frameworks, InSpec code resembles natural language. Here's the format of a describe block.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>describe <span class="token operator">&lt;</span>entity<span class="token operator">&gt;</span> <span class="token keyword">do</span>
  it <span class="token punctuation">{</span> <span class="token operator">&lt;</span>expectation<span class="token operator">&gt;</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>An InSpec test has two main components: the subject to examine and the subject's expected state. Here, <code>&lt;entity&gt;</code> is the subject you want to examine, for example, a package name, service, file, or network port. The <code>&lt;expectation&gt;</code> part specifies the desired result or expected state, for example, that a port should be open (or perhaps should not be open.)</p> <p>Let's take a closer look at the <code>describe</code> block in the example.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>describe file<span class="token punctuation">(</span><span class="token string">'/tmp'</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
  it <span class="token punctuation">{</span> should be_directory <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Because InSpec resembles human-readable language, you might read this test as &quot;/tmp should be a directory.&quot; Let's break down each component.</p> <hr> <h4 id="_3-3-1-file"><a href="#_3-3-1-file" aria-hidden="true" class="header-anchor">#</a> 3.3.1. file</h4> <p><a href="https://www.inspec.io/docs/reference/resources/file/" target="_blank" rel="noopener noreferrer">file<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is an InSpec <a href="https://www.inspec.io/docs/reference/resources/" target="_blank" rel="noopener noreferrer">resource<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. If you're familiar with Chef, you know that a resource configures one part of the system. InSpec resources are similar. For example, the InSpec file resource tests for file attributes, including a file's owner, mode, and permissions. The example examines the /tmp directory.</p> <hr> <h4 id="_3-3-2-it"><a href="#_3-3-2-it" aria-hidden="true" class="header-anchor">#</a> 3.3.2. it</h4> <p>The <code>it</code> statement validates one of your resource's features. A <code>describe</code> block contains one or more <code>it</code> statements. <code>it</code> enables you to test the resource itself. You'll also see <code>its</code>, which describes some feature of the resource, such as its mode or owner. You'll see examples of both <code>it</code> and <code>its</code> shortly.</p> <hr> <h4 id="_3-3-3-should"><a href="#_3-3-3-should" aria-hidden="true" class="header-anchor">#</a> 3.3.3. should</h4> <p><code>should</code> describes the expectation. <code>should</code> asserts that the condition that follows <em>should</em> be true. Alternatively, <code>should_not</code> asserts that the condition that follows <em>should not</em> be true. You'll see examples of both shortly.</p> <hr> <h4 id="_3-3-4-be-directory"><a href="#_3-3-4-be-directory" aria-hidden="true" class="header-anchor">#</a> 3.3.4. be_directory</h4> <p><code>be_directory</code> is an example of a <a href="https://www.inspec.io/docs/reference/matchers/" target="_blank" rel="noopener noreferrer">matcher<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. A matcher compares a resource's actual value to its expected value. InSpec provides several predefined matchers. The <code>file</code> resource provides the <code>be_directory</code> matcher.</p> <h2 id="_4-advanced-techniques-in-profile-development"><a href="#_4-advanced-techniques-in-profile-development" aria-hidden="true" class="header-anchor">#</a> 4. Advanced techniques in profile development</h2> <h3 id="_4-1-rspec-explicit-subject"><a href="#_4-1-rspec-explicit-subject" aria-hidden="true" class="header-anchor">#</a> 4.1. rspec Explicit Subject</h3> <p>Here we have a inspec test that lists out it's current directory. Our original test code looks like this</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>describe command<span class="token punctuation">(</span><span class="token string">'ls -al'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>strip <span class="token keyword">do</span>
  it <span class="token punctuation">{</span> should_not be_empty <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>If we would like to have a more <a href="https://relishapp.com/rspec/rspec-core/docs/subject/explicit-subject" target="_blank" rel="noopener noreferrer">Explicit Subject<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> then we could refactor the code like this example</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>describe <span class="token string">&quot;this is a detailed message&quot;</span> <span class="token keyword">do</span>
  subject <span class="token punctuation">{</span> command<span class="token punctuation">(</span><span class="token string">'ls -al'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>strip <span class="token punctuation">}</span>
  it<span class="token punctuation">{</span> should_not be_empty <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-2-looping-file-structure"><a href="#_4-2-looping-file-structure" aria-hidden="true" class="header-anchor">#</a> 4.2. looping file structure</h3> <p>For looping through a file directory, the directory resource is not powerful enough to do that, so we are required to use the <code>command</code> resource and run a <code>find</code> or it's equivalent for your target OS. This can be very resource intensive on your target so try to be as specific as possible with your search such as the example below:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>command<span class="token punctuation">(</span><span class="token string">'find ~/* -type f -maxdepth 0 -xdev'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>split<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>fname<span class="token operator">|</span>
  describe file<span class="token punctuation">(</span>fname<span class="token punctuation">)</span> <span class="token keyword">do</span>
    its<span class="token punctuation">(</span><span class="token string">'owner'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should cmp <span class="token string">'ec2-user'</span> <span class="token punctuation">}</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_4-3-checking-password-encryption"><a href="#_4-3-checking-password-encryption" aria-hidden="true" class="header-anchor">#</a> 4.3. Checking password encryption</h3> <p>Here we have an inspec test that checks if passwords are SHA512 hashes. As a quick thought exercise can you think of how we can adjust the control below to support SHA512 or higher assuming where you are testing uses SHA1024 or even SHA2048?</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>bad_users <span class="token operator">=</span> inspec<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>where <span class="token punctuation">{</span> password <span class="token operator">!=</span> <span class="token string">&quot;*&quot;</span> <span class="token operator">&amp;&amp;</span> password <span class="token operator">!=</span> <span class="token string">&quot;!&quot;</span> <span class="token operator">&amp;&amp;</span> password <span class="token operator">!</span><span class="token operator">~</span> <span class="token regex">/\$6\$/</span> <span class="token punctuation">}</span><span class="token punctuation">.</span>users

describe <span class="token string">'Password hashes in /etc/shadow'</span> <span class="token keyword">do</span>
  it <span class="token string">'should only contain SHA512 hashes'</span> <span class="token keyword">do</span>
    failure_message <span class="token operator">=</span> <span class="token string">&quot;Users without SHA512 hashes: <span class="token interpolation"><span class="token delimiter tag">#{</span>bad_users<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token delimiter tag">}</span></span>&quot;</span>
    expect<span class="token punctuation">(</span>bad_users<span class="token punctuation">)</span><span class="token punctuation">.</span>to be_empty<span class="token punctuation">,</span> failure_message
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_5-exploring-inspec-resources"><a href="#_5-exploring-inspec-resources" aria-hidden="true" class="header-anchor">#</a> 5. Exploring InSpec Resources</h2> <p>Before we dive into the course we want to take a look into what is a resource.</p> <p>When writing InSpec code, many resources are available to you.</p> <ul><li>You can <a href="https://www.inspec.io/docs/reference/resources/" target="_blank" rel="noopener noreferrer">explore the InSpec resources<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to see which resources are available.</li> <li>You can <a href="https://github.com/inspec/inspec/tree/master/lib/inspec/resources" target="_blank" rel="noopener noreferrer">examine the source code<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to see what's available. For example, you can see how file and other InSpec resources are implemented.</li></ul> <p>There's also <a href="https://www.inspec.io/docs/reference/dsl_resource/" target="_blank" rel="noopener noreferrer">Resource DSL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, which gives a brief overview of how to write your own resource.</p> <h3 id="_5-1-resource-overview"><a href="#_5-1-resource-overview" aria-hidden="true" class="header-anchor">#</a> 5.1. Resource Overview</h3> <p>Resources may be added to profiles in the libraries folder:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ tree examples/profile
examples/profile
<span class="token punctuation">..</span>.
├── libraries
│   └── gordon_config.rb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_5-2-resource-structure"><a href="#_5-2-resource-structure" aria-hidden="true" class="header-anchor">#</a> 5.2. Resource Structure</h3> <p>The smallest possible resource takes this form:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Tiny</span> <span class="token operator">&lt;</span> <span class="token constant">Inspec</span><span class="token punctuation">.</span>resource<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  name <span class="token string">'tiny'</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Resources are written as a regular Ruby class which inherits from Inspec.resource. The number (1) specifies the version this resource plugin targets. As Chef InSpec evolves, this interface may change and may require a higher version.</p> <p>The following attributes can be configured:</p> <p>name - Identifier of the resource (required)
desc - Description of the resource (optional)
example - Example usage of the resource (optional)
supports - (Chef InSpec 2.0+) Platform restrictions of the resource (optional)
The following methods are available to the resource:</p> <p>inspec - Contains a registry of all other resources to interact with the operating system or target in general.
skip_resource - A resource may call this method to indicate that requirements aren’t met. All tests that use this resource will be marked as skipped.</p> <p>The following example shows a full resource using attributes and methods to provide simple access to a configuration file:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">GordonConfig</span> <span class="token operator">&lt;</span> <span class="token constant">Inspec</span><span class="token punctuation">.</span>resource<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  name <span class="token string">'gordon_config'</span>

  <span class="token comment"># Restrict to only run on the below platforms (if none were given, all OS's supported)</span>
  supports platform_family<span class="token punctuation">:</span> <span class="token string">'fedora'</span>
  supports platform<span class="token punctuation">:</span> <span class="token string">'centos'</span><span class="token punctuation">,</span> release<span class="token punctuation">:</span> <span class="token string">'6.9'</span>
  <span class="token comment"># Supports `*` for wildcard matcher in the release</span>
  supports platform<span class="token punctuation">:</span> <span class="token string">'centos'</span><span class="token punctuation">,</span> release<span class="token punctuation">:</span> <span class="token string">'7.*'</span>

  desc '
    <span class="token constant">Resource</span> description <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  '

  example '
    describe gordon_config <span class="token keyword">do</span>
      its<span class="token punctuation">(</span><span class="token string">&quot;signal&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should eq <span class="token string">&quot;on&quot;</span> <span class="token punctuation">}</span>
    <span class="token keyword">end</span>
  '

  <span class="token comment"># Load the configuration file on initialization</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token keyword">nil</span><span class="token punctuation">)</span>
    <span class="token variable">@path</span> <span class="token operator">=</span> path <span class="token operator">||</span> <span class="token string">'/etc/gordon.conf'</span>
    <span class="token variable">@params</span> <span class="token operator">=</span> <span class="token constant">SimpleConfig</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span> read_content <span class="token punctuation">)</span>
  <span class="token keyword">end</span>

  <span class="token comment"># Expose all parameters of the configuration file.</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">method_missing</span></span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token variable">@params</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span>
  <span class="token keyword">end</span>

  <span class="token keyword">private</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">read_content</span></span>
    f <span class="token operator">=</span> inspec<span class="token punctuation">.</span>file<span class="token punctuation">(</span><span class="token variable">@path</span><span class="token punctuation">)</span>
    <span class="token comment"># Test if the path exist and that it's a file</span>
    <span class="token keyword">if</span> f<span class="token punctuation">.</span>file<span class="token operator">?</span>
      <span class="token comment"># Retrieve the file's contents</span>
      f<span class="token punctuation">.</span>content
    <span class="token keyword">else</span>
      <span class="token comment"># If the file doesn't exist, skip all tests that use gordon_config</span>
      <span class="token keyword">raise</span> <span class="token constant">Inspec</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Exceptions</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ResourceSkipped</span><span class="token punctuation">,</span> <span class="token string">&quot;Can't read config at <span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token variable">@path</span><span class="token delimiter tag">}</span></span>&quot;</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h2 id="_6-explore-the-basics-of-a-resource"><a href="#_6-explore-the-basics-of-a-resource" aria-hidden="true" class="header-anchor">#</a> 6. Explore the basics of a resource</h2> <h3 id="_6-1-class"><a href="#_6-1-class" aria-hidden="true" class="header-anchor">#</a> 6.1. class</h3> <h3 id="_6-2-name"><a href="#_6-2-name" aria-hidden="true" class="header-anchor">#</a> 6.2. name</h3> <h3 id="_6-3-supports"><a href="#_6-3-supports" aria-hidden="true" class="header-anchor">#</a> 6.3. supports</h3> <h3 id="_6-4-desc-examples"><a href="#_6-4-desc-examples" aria-hidden="true" class="header-anchor">#</a> 6.4. desc &amp; examples</h3> <h3 id="_6-5-initialize-method"><a href="#_6-5-initialize-method" aria-hidden="true" class="header-anchor">#</a> 6.5. initialize method</h3> <h3 id="_6-6-functionality-methods"><a href="#_6-6-functionality-methods" aria-hidden="true" class="header-anchor">#</a> 6.6. functionality methods</h3> <h2 id="_7-local-resource-vs-builtin-resource"><a href="#_7-local-resource-vs-builtin-resource" aria-hidden="true" class="header-anchor">#</a> 7. Local Resource vs Builtin Resource</h2> <h3 id="_7-1-local-resource"><a href="#_7-1-local-resource" aria-hidden="true" class="header-anchor">#</a> 7.1. Local Resource</h3> <h3 id="_7-2-builtin-inspec-resource"><a href="#_7-2-builtin-inspec-resource" aria-hidden="true" class="header-anchor">#</a> 7.2. Builtin InSpec Resource</h3> <h2 id="_8-dissecting-resources"><a href="#_8-dissecting-resources" aria-hidden="true" class="header-anchor">#</a> 8. Dissecting Resources</h2> <h3 id="_8-1-nginx"><a href="#_8-1-nginx" aria-hidden="true" class="header-anchor">#</a> 8.1. NGINX</h3> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">require</span> <span class="token string">&quot;pathname&quot;</span>
<span class="token keyword">require</span> <span class="token string">&quot;hashie/mash&quot;</span>
<span class="token keyword">require</span> <span class="token string">&quot;inspec/resources/command&quot;</span>

<span class="token keyword">module</span> <span class="token constant">Inspec</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Resources</span>
  <span class="token keyword">class</span> <span class="token class-name">Nginx</span> <span class="token operator">&lt;</span> <span class="token constant">Inspec</span><span class="token punctuation">.</span>resource<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    name <span class="token string">&quot;nginx&quot;</span>
    supports platform<span class="token punctuation">:</span> <span class="token string">&quot;unix&quot;</span>
    desc <span class="token string">&quot;Use the nginx InSpec audit resource to test information about your NGINX instance.&quot;</span>
    example <span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">~</span><span class="token constant">EXAMPLE</span>
      describe nginx <span class="token keyword">do</span>
        its<span class="token punctuation">(</span><span class="token string">'conf_path'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should cmp <span class="token string">'/etc/nginx/nginx.conf'</span> <span class="token punctuation">}</span>
      <span class="token keyword">end</span>
      describe nginx<span class="token punctuation">(</span><span class="token string">'/etc/sbin/'</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
        its<span class="token punctuation">(</span><span class="token string">'version'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should be <span class="token operator">&gt;=</span> <span class="token string">'1.0.0'</span> <span class="token punctuation">}</span>
      <span class="token keyword">end</span>
      describe nginx <span class="token keyword">do</span>
        its<span class="token punctuation">(</span><span class="token string">'modules'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should include <span class="token string">'my_module'</span> <span class="token punctuation">}</span>
      <span class="token keyword">end</span>
    <span class="token constant">EXAMPLE</span>
    attr_reader <span class="token symbol">:params</span><span class="token punctuation">,</span> <span class="token symbol">:bin_dir</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>nginx_path <span class="token operator">=</span> <span class="token string">&quot;/usr/sbin/nginx&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> skip_resource <span class="token string">&quot;The `nginx` resource is not yet available on your OS.&quot;</span> <span class="token keyword">if</span> inspec<span class="token punctuation">.</span>os<span class="token punctuation">.</span>windows<span class="token operator">?</span>
      <span class="token keyword">return</span> skip_resource <span class="token string">&quot;The `nginx` binary not found in the path provided.&quot;</span> <span class="token keyword">unless</span> inspec<span class="token punctuation">.</span>command<span class="token punctuation">(</span>nginx_path<span class="token punctuation">)</span><span class="token punctuation">.</span>exist<span class="token operator">?</span>

      cmd <span class="token operator">=</span> inspec<span class="token punctuation">.</span>command<span class="token punctuation">(</span><span class="token string">&quot;<span class="token interpolation"><span class="token delimiter tag">#{</span>nginx_path<span class="token delimiter tag">}</span></span> -V 2&gt;&amp;1&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> cmd<span class="token punctuation">.</span>exit_status <span class="token operator">!=</span> <span class="token number">0</span>
        <span class="token keyword">return</span> skip_resource <span class="token string">&quot;Error using the command nginx -V&quot;</span>
      <span class="token keyword">end</span>

      <span class="token variable">@data</span> <span class="token operator">=</span> cmd<span class="token punctuation">.</span>stdout
      <span class="token variable">@params</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      read_content
    <span class="token keyword">end</span>

    <span class="token string">%w{error_log_path http_client_body_temp_path http_fastcgi_temp_path http_log_path http_proxy_temp_path http_scgi_temp_path http_uwsgi_temp_path lock_path modules_path prefix sbin_path service version}</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>property<span class="token operator">|</span>
      <span class="token keyword">define_method</span><span class="token punctuation">(</span>property<span class="token punctuation">.</span>to_sym<span class="token punctuation">)</span> <span class="token keyword">do</span>
        <span class="token variable">@params</span><span class="token punctuation">[</span>property<span class="token punctuation">.</span>to_sym<span class="token punctuation">]</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">openssl_version</span></span>
      result <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/built with OpenSSL\s(\S+)\s(\d+\s\S+\s\d{4})/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten
      <span class="token constant">Hashie</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Mash</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;version&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;date&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">compiler_info</span></span>
      result <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/built by (\S+)\s(\S+)\s(\S+)/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten
      <span class="token constant">Hashie</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Mash</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;compiler&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;version&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;date&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> result<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">support_info</span></span>
      support_info <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/(.*\S+) support enabled/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten
      support_info<span class="token punctuation">.</span>empty<span class="token operator">?</span> <span class="token operator">?</span> <span class="token keyword">nil</span> <span class="token punctuation">:</span> support_info<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">modules</span></span>
      <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/--with-(\S+)_module/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">to_s</span></span>
      <span class="token string">&quot;Nginx Environment&quot;</span>
    <span class="token keyword">end</span>

    <span class="token keyword">private</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">read_content</span></span>
      parse_config
      parse_path
      parse_http_path
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">parse_config</span></span>
      <span class="token variable">@params</span><span class="token punctuation">[</span><span class="token symbol">:prefix</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/--prefix=(\S+)\s/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>first
      <span class="token variable">@params</span><span class="token punctuation">[</span><span class="token symbol">:service</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;nginx&quot;</span>
      <span class="token variable">@params</span><span class="token punctuation">[</span><span class="token symbol">:version</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">%r{nginx version: nginx\/(\S+)\s}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>first
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">parse_path</span></span>
      <span class="token variable">@params</span><span class="token punctuation">[</span><span class="token symbol">:sbin_path</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/--sbin-path=(\S+)\s/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>first
      <span class="token variable">@params</span><span class="token punctuation">[</span><span class="token symbol">:modules_path</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/--modules-path=(\S+)\s/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>first
      <span class="token variable">@params</span><span class="token punctuation">[</span><span class="token symbol">:error_log_path</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/--error-log-path=(\S+)\s/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>first
      <span class="token variable">@params</span><span class="token punctuation">[</span><span class="token symbol">:http_log_path</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/--http-log-path=(\S+)\s/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>first
      <span class="token variable">@params</span><span class="token punctuation">[</span><span class="token symbol">:lock_path</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/--lock-path=(\S+)\s/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>first
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">parse_http_path</span></span>
      <span class="token variable">@params</span><span class="token punctuation">[</span><span class="token symbol">:http_client_body_temp_path</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/--http-client-body-temp-path=(\S+)\s/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>first
      <span class="token variable">@params</span><span class="token punctuation">[</span><span class="token symbol">:http_proxy_temp_path</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/--http-proxy-temp-path=(\S+)\s/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>first
      <span class="token variable">@params</span><span class="token punctuation">[</span><span class="token symbol">:http_fastcgi_temp_path</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/--http-fastcgi-temp-path=(\S+)\s/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>first
      <span class="token variable">@params</span><span class="token punctuation">[</span><span class="token symbol">:http_uwsgi_temp_path</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/--http-uwsgi-temp-path=(\S+)\s/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>first
      <span class="token variable">@params</span><span class="token punctuation">[</span><span class="token symbol">:http_scgi_temp_path</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">@data</span><span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token regex">/--http-scgi-temp-path=(\S+)\s/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>first
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br></div></div><h3 id="_8-2-file"><a href="#_8-2-file" aria-hidden="true" class="header-anchor">#</a> 8.2. File</h3> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># copyright: 2015, Vulcano Security GmbH</span>

<span class="token keyword">require</span> <span class="token string">&quot;shellwords&quot;</span>
<span class="token keyword">require</span> <span class="token string">&quot;inspec/utils/parser&quot;</span>

<span class="token keyword">module</span> <span class="token constant">Inspec</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Resources</span>
  <span class="token keyword">module</span> <span class="token constant">FilePermissionsSelector</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">select_file_perms_style</span></span><span class="token punctuation">(</span>os<span class="token punctuation">)</span>
      <span class="token keyword">if</span> os<span class="token punctuation">.</span>unix<span class="token operator">?</span>
        <span class="token constant">UnixFilePermissions</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>inspec<span class="token punctuation">)</span>
      <span class="token keyword">elsif</span> os<span class="token punctuation">.</span>windows<span class="token operator">?</span>
        <span class="token constant">WindowsFilePermissions</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>inspec<span class="token punctuation">)</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  <span class="token comment"># TODO: rename file_resource.rb</span>
  <span class="token keyword">class</span> <span class="token class-name">FileResource</span> <span class="token operator">&lt;</span> <span class="token constant">Inspec</span><span class="token punctuation">.</span>resource<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    include <span class="token constant">FilePermissionsSelector</span>
    include <span class="token constant">LinuxMountParser</span>

    name <span class="token string">&quot;file&quot;</span>
    supports platform<span class="token punctuation">:</span> <span class="token string">&quot;unix&quot;</span>
    supports platform<span class="token punctuation">:</span> <span class="token string">&quot;windows&quot;</span>
    desc <span class="token string">&quot;Use the file InSpec audit resource to test all system file types, including files, directories, symbolic links, named pipes, sockets, character devices, block devices, and doors.&quot;</span>
    example <span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">~</span><span class="token constant">EXAMPLE</span>
      describe file<span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
        it <span class="token punctuation">{</span> should exist <span class="token punctuation">}</span>
        it <span class="token punctuation">{</span> should be_file <span class="token punctuation">}</span>
        it <span class="token punctuation">{</span> should be_readable <span class="token punctuation">}</span>
        it <span class="token punctuation">{</span> should be_writable <span class="token punctuation">}</span>
        it <span class="token punctuation">{</span> should be_executable<span class="token punctuation">.</span>by_user<span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        it <span class="token punctuation">{</span> should be_owned_by <span class="token string">'root'</span> <span class="token punctuation">}</span>
        its<span class="token punctuation">(</span><span class="token string">'mode'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should cmp <span class="token string">'0644'</span> <span class="token punctuation">}</span>
      <span class="token keyword">end</span>
    <span class="token constant">EXAMPLE</span>

    attr_reader <span class="token symbol">:file</span><span class="token punctuation">,</span> <span class="token symbol">:mount_options</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
      <span class="token comment"># select permissions style</span>
      <span class="token variable">@perms_provider</span> <span class="token operator">=</span> select_file_perms_style<span class="token punctuation">(</span>inspec<span class="token punctuation">.</span>os<span class="token punctuation">)</span>
      <span class="token variable">@file</span> <span class="token operator">=</span> inspec<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>file<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token string">%w{
      type exist? file? block_device? character_device? socket? directory?
      symlink? pipe? mode mode? owner owned_by? group grouped_into?
      link_path shallow_link_path linked_to? mtime size selinux_label immutable?
      product_version file_version version? md5sum sha256sum
      path basename source source_path uid gid
    }</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>m<span class="token operator">|</span>
      <span class="token keyword">define_method</span> m <span class="token keyword">do</span> <span class="token operator">|</span><span class="token operator">*</span>args<span class="token operator">|</span>
        file<span class="token punctuation">.</span>send<span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">content</span></span>
      res <span class="token operator">=</span> file<span class="token punctuation">.</span>content
      <span class="token keyword">return</span> <span class="token keyword">nil</span> <span class="token keyword">if</span> res<span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>

      res<span class="token punctuation">.</span>force_encoding<span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">contain</span></span><span class="token punctuation">(</span><span class="token operator">*</span>_<span class="token punctuation">)</span>
      <span class="token keyword">raise</span> <span class="token string">&quot;Contain is not supported. Please use standard RSpec matchers.&quot;</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">readable</span></span><span class="token operator">?</span><span class="token punctuation">(</span>by_usergroup<span class="token punctuation">,</span> by_specific_user<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token keyword">false</span> <span class="token keyword">unless</span> exist<span class="token operator">?</span>
      <span class="token keyword">return</span> skip_resource <span class="token string">&quot;`readable?` is not supported on your OS yet.&quot;</span> <span class="token keyword">if</span> <span class="token variable">@perms_provider</span><span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>

      file_permission_granted<span class="token operator">?</span><span class="token punctuation">(</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">,</span> by_usergroup<span class="token punctuation">,</span> by_specific_user<span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">writable</span></span><span class="token operator">?</span><span class="token punctuation">(</span>by_usergroup<span class="token punctuation">,</span> by_specific_user<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token keyword">false</span> <span class="token keyword">unless</span> exist<span class="token operator">?</span>
      <span class="token keyword">return</span> skip_resource <span class="token string">&quot;`writable?` is not supported on your OS yet.&quot;</span> <span class="token keyword">if</span> <span class="token variable">@perms_provider</span><span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>

      file_permission_granted<span class="token operator">?</span><span class="token punctuation">(</span><span class="token string">&quot;write&quot;</span><span class="token punctuation">,</span> by_usergroup<span class="token punctuation">,</span> by_specific_user<span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">executable</span></span><span class="token operator">?</span><span class="token punctuation">(</span>by_usergroup<span class="token punctuation">,</span> by_specific_user<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token keyword">false</span> <span class="token keyword">unless</span> exist<span class="token operator">?</span>
      <span class="token keyword">return</span> skip_resource <span class="token string">&quot;`executable?` is not supported on your OS yet.&quot;</span> <span class="token keyword">if</span> <span class="token variable">@perms_provider</span><span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>

      file_permission_granted<span class="token operator">?</span><span class="token punctuation">(</span><span class="token string">&quot;execute&quot;</span><span class="token punctuation">,</span> by_usergroup<span class="token punctuation">,</span> by_specific_user<span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">allowed</span></span><span class="token operator">?</span><span class="token punctuation">(</span>permission<span class="token punctuation">,</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token keyword">false</span> <span class="token keyword">unless</span> exist<span class="token operator">?</span>
      <span class="token keyword">return</span> skip_resource <span class="token string">&quot;`allowed?` is not supported on your OS yet.&quot;</span> <span class="token keyword">if</span> <span class="token variable">@perms_provider</span><span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>

      file_permission_granted<span class="token operator">?</span><span class="token punctuation">(</span>permission<span class="token punctuation">,</span> opts<span class="token punctuation">[</span><span class="token symbol">:by</span><span class="token punctuation">]</span><span class="token punctuation">,</span> opts<span class="token punctuation">[</span><span class="token symbol">:by_user</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">mounted</span></span><span class="token operator">?</span><span class="token punctuation">(</span>expected_options <span class="token operator">=</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> identical <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">)</span>
      mounted <span class="token operator">=</span> file<span class="token punctuation">.</span>mounted

      <span class="token comment"># return if no additional parameters have been provided</span>
      <span class="token keyword">return</span> file<span class="token punctuation">.</span>mounted<span class="token operator">?</span> <span class="token keyword">if</span> expected_options<span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>

      <span class="token comment"># deprecation warning, this functionality will be removed in future version</span>
      <span class="token constant">Inspec</span><span class="token punctuation">.</span>deprecate<span class="token punctuation">(</span><span class="token symbol">:file_resource_be_mounted_matchers</span><span class="token punctuation">,</span> <span class="token string">&quot;The file resource `be_mounted.with` and `be_mounted.only_with` matchers are deprecated. Please use the `mount` resource instead&quot;</span><span class="token punctuation">)</span>

      <span class="token comment"># we cannot read mount data on non-Linux systems</span>
      <span class="token keyword">return</span> <span class="token keyword">nil</span> <span class="token keyword">unless</span> inspec<span class="token punctuation">.</span>os<span class="token punctuation">.</span>linux<span class="token operator">?</span>

      <span class="token comment"># parse content if we are on linux</span>
      <span class="token variable">@mount_options</span> <span class="token operator">||</span><span class="token operator">=</span> parse_mount_options<span class="token punctuation">(</span>mounted<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span>

      <span class="token keyword">if</span> identical
        <span class="token comment"># check if the options should be identical</span>
        <span class="token variable">@mount_options</span> <span class="token operator">==</span> expected_options
      <span class="token keyword">else</span>
        <span class="token comment"># otherwise compare the selected values</span>
        <span class="token variable">@mount_options</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span>expected_options<span class="token punctuation">)</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">suid</span></span>
      <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">04000</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
    <span class="token keyword">end</span>

    <span class="token keyword">alias</span> setuid<span class="token operator">?</span> suid

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">sgid</span></span>
      <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">02000</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
    <span class="token keyword">end</span>

    <span class="token keyword">alias</span> setgid<span class="token operator">?</span> sgid

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">sticky</span></span>
      <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">01000</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
    <span class="token keyword">end</span>

    <span class="token keyword">alias</span> sticky<span class="token operator">?</span> sticky

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">more_permissive_than</span></span><span class="token operator">?</span><span class="token punctuation">(</span>max_mode <span class="token operator">=</span> <span class="token keyword">nil</span><span class="token punctuation">)</span>
      <span class="token keyword">raise</span> <span class="token constant">Inspec</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Exceptions</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ResourceFailed</span><span class="token punctuation">,</span> <span class="token string">&quot;The file&quot;</span> <span class="token operator">+</span> file<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">&quot;doesn't seem to exist&quot;</span> <span class="token keyword">unless</span> exist<span class="token operator">?</span>
      <span class="token keyword">raise</span> <span class="token constant">ArgumentError</span><span class="token punctuation">,</span> <span class="token string">&quot;You must proivde a value for the `maximum allowable permission` for the file.&quot;</span> <span class="token keyword">if</span> max_mode<span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>
      <span class="token keyword">raise</span> <span class="token constant">ArgumentError</span><span class="token punctuation">,</span> <span class="token string">&quot;You must proivde the `maximum permission target` as a `String`, you provided: &quot;</span> <span class="token operator">+</span> max_mode<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span>to_s <span class="token keyword">unless</span> max_mode<span class="token punctuation">.</span>is_a<span class="token operator">?</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">)</span>
      <span class="token keyword">raise</span> <span class="token constant">ArgumentError</span><span class="token punctuation">,</span> <span class="token string">&quot;The value of the `maximum permission target` should be a valid file mode in 4-ditgit octal format: for example, `0644` or `0777`&quot;</span> <span class="token keyword">unless</span> <span class="token regex">/(0)?([0-7])([0-7])([0-7])/</span><span class="token punctuation">.</span>match<span class="token operator">?</span><span class="token punctuation">(</span>max_mode<span class="token punctuation">)</span>

      <span class="token comment"># Using the files mode and a few bit-wise calculations we can ensure a</span>
      <span class="token comment"># file is no more permisive than desired.</span>
      <span class="token comment">#</span>
      <span class="token comment"># 1. Calculate the inverse of the desired mode (e.g., 0644) by XOR it with</span>
      <span class="token comment"># 0777 (all 1s). We are interested in the bits that are currently 0 since</span>
      <span class="token comment"># it indicates that the actual mode is more permissive than the desired mode.</span>
      <span class="token comment"># Conversely, we dont care about the bits that are currently 1 because they</span>
      <span class="token comment"># cannot be any more permissive and we can safely ignore them.</span>
      <span class="token comment">#</span>
      <span class="token comment"># 2. Calculate the above result of ANDing the actual mode and the inverse</span>
      <span class="token comment"># mode. This will determine if any of the bits that would indicate a more</span>
      <span class="token comment"># permissive mode are set in the actual mode.</span>
      <span class="token comment">#</span>
      <span class="token comment"># 3. If the result is 0000, the files mode is equal</span>
      <span class="token comment"># to or less permissive than the desired mode (PASS). Otherwise, the files</span>
      <span class="token comment"># mode is more permissive than the desired mode (FAIL).</span>

      max_mode <span class="token operator">=</span> max_mode<span class="token punctuation">.</span>to_i<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
      inv_mode <span class="token operator">=</span> <span class="token number">0777</span> <span class="token operator">^</span> max_mode

      inv_mode <span class="token operator">&amp;</span> file<span class="token punctuation">.</span>mode <span class="token operator">!=</span> <span class="token number">0</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">to_s</span></span>
      <span class="token string">&quot;File <span class="token interpolation"><span class="token delimiter tag">#{</span>source_path<span class="token delimiter tag">}</span></span>&quot;</span>
    <span class="token keyword">end</span>

    <span class="token keyword">private</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">file_permission_granted</span></span><span class="token operator">?</span><span class="token punctuation">(</span>access_type<span class="token punctuation">,</span> by_usergroup<span class="token punctuation">,</span> by_specific_user<span class="token punctuation">)</span>
      <span class="token keyword">raise</span> <span class="token string">&quot;`file_permission_granted?` is not supported on your OS&quot;</span> <span class="token keyword">if</span> <span class="token variable">@perms_provider</span><span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>

      <span class="token keyword">if</span> by_specific_user<span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span> <span class="token operator">||</span> by_specific_user<span class="token punctuation">.</span>empty<span class="token operator">?</span>
        <span class="token variable">@perms_provider</span><span class="token punctuation">.</span>check_file_permission_by_mask<span class="token punctuation">(</span>file<span class="token punctuation">,</span> access_type<span class="token punctuation">,</span> by_usergroup<span class="token punctuation">,</span> by_specific_user<span class="token punctuation">)</span>
      <span class="token keyword">else</span>
        <span class="token variable">@perms_provider</span><span class="token punctuation">.</span>check_file_permission_by_user<span class="token punctuation">(</span>access_type<span class="token punctuation">,</span> by_specific_user<span class="token punctuation">,</span> source_path<span class="token punctuation">)</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  <span class="token keyword">class</span> <span class="token class-name">FilePermissions</span>
    attr_reader <span class="token symbol">:inspec</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>inspec<span class="token punctuation">)</span>
      <span class="token variable">@inspec</span> <span class="token operator">=</span> inspec
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  <span class="token keyword">class</span> <span class="token class-name">UnixFilePermissions</span> <span class="token operator">&lt;</span> <span class="token constant">FilePermissions</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">permission_flag</span></span><span class="token punctuation">(</span>access_type<span class="token punctuation">)</span>
      <span class="token keyword">case</span> access_type
      <span class="token keyword">when</span> <span class="token string">&quot;read&quot;</span>
        <span class="token string">&quot;r&quot;</span>
      <span class="token keyword">when</span> <span class="token string">&quot;write&quot;</span>
        <span class="token string">&quot;w&quot;</span>
      <span class="token keyword">when</span> <span class="token string">&quot;execute&quot;</span>
        <span class="token string">&quot;x&quot;</span>
      <span class="token keyword">else</span>
        <span class="token keyword">raise</span> <span class="token string">&quot;Invalid access_type provided&quot;</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">usergroup_for</span></span><span class="token punctuation">(</span>usergroup<span class="token punctuation">,</span> specific_user<span class="token punctuation">)</span>
      <span class="token keyword">if</span> usergroup <span class="token operator">==</span> <span class="token string">&quot;others&quot;</span>
        <span class="token string">&quot;other&quot;</span>
      <span class="token keyword">elsif</span> <span class="token punctuation">(</span>usergroup<span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span> <span class="token operator">||</span> usergroup<span class="token punctuation">.</span>empty<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> specific_user<span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>
        <span class="token string">&quot;all&quot;</span>
      <span class="token keyword">else</span>
        usergroup
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">check_file_permission_by_mask</span></span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> access_type<span class="token punctuation">,</span> usergroup<span class="token punctuation">,</span> specific_user<span class="token punctuation">)</span>
      usergroup <span class="token operator">=</span> usergroup_for<span class="token punctuation">(</span>usergroup<span class="token punctuation">,</span> specific_user<span class="token punctuation">)</span>
      flag <span class="token operator">=</span> permission_flag<span class="token punctuation">(</span>access_type<span class="token punctuation">)</span>
      mask <span class="token operator">=</span> file<span class="token punctuation">.</span>unix_mode_mask<span class="token punctuation">(</span>usergroup<span class="token punctuation">,</span> flag<span class="token punctuation">)</span>
      <span class="token keyword">raise</span> <span class="token string">&quot;Invalid usergroup/owner provided&quot;</span> <span class="token keyword">if</span> mask<span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>

      <span class="token punctuation">(</span>file<span class="token punctuation">.</span>mode <span class="token operator">&amp;</span> mask<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">check_file_permission_by_user</span></span><span class="token punctuation">(</span>access_type<span class="token punctuation">,</span> user<span class="token punctuation">,</span> path<span class="token punctuation">)</span>
      flag <span class="token operator">=</span> permission_flag<span class="token punctuation">(</span>access_type<span class="token punctuation">)</span>
      <span class="token keyword">if</span> inspec<span class="token punctuation">.</span>os<span class="token punctuation">.</span>linux<span class="token operator">?</span>
        perm_cmd <span class="token operator">=</span> <span class="token string">&quot;su -s /bin/sh -c \&quot;test -<span class="token interpolation"><span class="token delimiter tag">#{</span>flag<span class="token delimiter tag">}</span></span> <span class="token interpolation"><span class="token delimiter tag">#{</span>path<span class="token delimiter tag">}</span></span>\&quot; <span class="token interpolation"><span class="token delimiter tag">#{</span>user<span class="token delimiter tag">}</span></span>&quot;</span>
      <span class="token keyword">elsif</span> inspec<span class="token punctuation">.</span>os<span class="token punctuation">.</span>bsd<span class="token operator">?</span> <span class="token operator">||</span> inspec<span class="token punctuation">.</span>os<span class="token punctuation">.</span>solaris<span class="token operator">?</span>
        perm_cmd <span class="token operator">=</span> <span class="token string">&quot;sudo -u <span class="token interpolation"><span class="token delimiter tag">#{</span>user<span class="token delimiter tag">}</span></span> test -<span class="token interpolation"><span class="token delimiter tag">#{</span>flag<span class="token delimiter tag">}</span></span> <span class="token interpolation"><span class="token delimiter tag">#{</span>path<span class="token delimiter tag">}</span></span>&quot;</span>
      <span class="token keyword">elsif</span> inspec<span class="token punctuation">.</span>os<span class="token punctuation">.</span>aix<span class="token operator">?</span>
        perm_cmd <span class="token operator">=</span> <span class="token string">&quot;su <span class="token interpolation"><span class="token delimiter tag">#{</span>user<span class="token delimiter tag">}</span></span> -c test -<span class="token interpolation"><span class="token delimiter tag">#{</span>flag<span class="token delimiter tag">}</span></span> <span class="token interpolation"><span class="token delimiter tag">#{</span>path<span class="token delimiter tag">}</span></span>&quot;</span>
      <span class="token keyword">elsif</span> inspec<span class="token punctuation">.</span>os<span class="token punctuation">.</span>hpux<span class="token operator">?</span>
        perm_cmd <span class="token operator">=</span> <span class="token string">&quot;su <span class="token interpolation"><span class="token delimiter tag">#{</span>user<span class="token delimiter tag">}</span></span> -c \&quot;test -<span class="token interpolation"><span class="token delimiter tag">#{</span>flag<span class="token delimiter tag">}</span></span> <span class="token interpolation"><span class="token delimiter tag">#{</span>path<span class="token delimiter tag">}</span></span>\&quot;&quot;</span>
      <span class="token keyword">else</span>
        <span class="token keyword">return</span> skip_resource <span class="token string">&quot;The `file` resource does not support `by_user` on your OS.&quot;</span>
      <span class="token keyword">end</span>

      cmd <span class="token operator">=</span> inspec<span class="token punctuation">.</span>command<span class="token punctuation">(</span>perm_cmd<span class="token punctuation">)</span>
      cmd<span class="token punctuation">.</span>exit_status <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token keyword">true</span> <span class="token punctuation">:</span> <span class="token keyword">false</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  <span class="token keyword">class</span> <span class="token class-name">WindowsFilePermissions</span> <span class="token operator">&lt;</span> <span class="token constant">FilePermissions</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">check_file_permission_by_mask</span></span><span class="token punctuation">(</span>_file<span class="token punctuation">,</span> _access_type<span class="token punctuation">,</span> _usergroup<span class="token punctuation">,</span> _specific_user<span class="token punctuation">)</span>
      <span class="token keyword">raise</span> <span class="token string">&quot;`check_file_permission_by_mask` is not supported on Windows&quot;</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">more_permissive_than</span></span><span class="token operator">?</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
      <span class="token keyword">raise</span> <span class="token constant">Inspec</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Exceptions</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ResourceSkipped</span><span class="token punctuation">,</span> <span class="token string">&quot;The `more_permissive_than?` matcher is not supported on your OS yet.&quot;</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">check_file_permission_by_user</span></span><span class="token punctuation">(</span>access_type<span class="token punctuation">,</span> user<span class="token punctuation">,</span> path<span class="token punctuation">)</span>
      access_rule <span class="token operator">=</span> translate_perm_names<span class="token punctuation">(</span>access_type<span class="token punctuation">)</span>
      access_rule <span class="token operator">=</span> convert_to_powershell_array<span class="token punctuation">(</span>access_rule<span class="token punctuation">)</span>

      cmd <span class="token operator">=</span> inspec<span class="token punctuation">.</span>command<span class="token punctuation">(</span><span class="token string">&quot;@(@((Get-Acl '<span class="token interpolation"><span class="token delimiter tag">#{</span>path<span class="token delimiter tag">}</span></span>').access | Where-Object {$_.AccessControlType -eq 'Allow' -and $_.IdentityReference -eq '<span class="token interpolation"><span class="token delimiter tag">#{</span>user<span class="token delimiter tag">}</span></span>' }) | Where-Object {($_.FileSystemRights.ToString().Split(',') | % {$_.trim()} | ? {<span class="token interpolation"><span class="token delimiter tag">#{</span>access_rule<span class="token delimiter tag">}</span></span> -contains $_}) -ne $null}) | measure | % { $_.Count }&quot;</span><span class="token punctuation">)</span>
      cmd<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>chomp <span class="token operator">==</span> <span class="token string">&quot;0&quot;</span> <span class="token operator">?</span> <span class="token keyword">false</span> <span class="token punctuation">:</span> <span class="token keyword">true</span>
    <span class="token keyword">end</span>

    <span class="token keyword">private</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">convert_to_powershell_array</span></span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
      <span class="token keyword">if</span> arr<span class="token punctuation">.</span>empty<span class="token operator">?</span>
        <span class="token string">&quot;@()&quot;</span>
      <span class="token keyword">else</span>
        <span class="token string">%{@('<span class="token interpolation"><span class="token delimiter tag">#{</span>arr<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">&quot;', '&quot;</span><span class="token punctuation">)</span><span class="token delimiter tag">}</span></span>')}</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token comment"># Translates a developer-friendly string into a list of acceptable</span>
    <span class="token comment"># FileSystemRights that match it, because Windows has a fun heirarchy</span>
    <span class="token comment"># of permissions that are able to be noted in multiple ways.</span>
    <span class="token comment">#</span>
    <span class="token comment"># See also: https://www.codeproject.com/Reference/871338/AccessControl-FileSystemRights-Permissions-Table</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">translate_perm_names</span></span><span class="token punctuation">(</span>access_type<span class="token punctuation">)</span>
      names <span class="token operator">=</span> translate_common_perms<span class="token punctuation">(</span>access_type<span class="token punctuation">)</span>
      names <span class="token operator">||</span><span class="token operator">=</span> translate_granular_perms<span class="token punctuation">(</span>access_type<span class="token punctuation">)</span>
      names <span class="token operator">||</span><span class="token operator">=</span> translate_uncommon_perms<span class="token punctuation">(</span>access_type<span class="token punctuation">)</span>
      <span class="token keyword">raise</span> <span class="token string">&quot;Invalid access_type provided&quot;</span> <span class="token keyword">unless</span> names

      names
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">translate_common_perms</span></span><span class="token punctuation">(</span>access_type<span class="token punctuation">)</span>
      <span class="token keyword">case</span> access_type
      <span class="token keyword">when</span> <span class="token string">&quot;full-control&quot;</span>
        <span class="token string">%w{FullControl}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;modify&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;full-control&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{Modify}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;read&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;modify&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{ReadAndExecute Read}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;write&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;modify&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{Write}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;execute&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;modify&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{ReadAndExecute ExecuteFile Traverse}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;delete&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;modify&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{Delete}</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">translate_uncommon_perms</span></span><span class="token punctuation">(</span>access_type<span class="token punctuation">)</span>
      <span class="token keyword">case</span> access_type
      <span class="token keyword">when</span> <span class="token string">&quot;delete-subdirectories-and-files&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;full-control&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{DeleteSubdirectoriesAndFiles}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;change-permissions&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;full-control&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{ChangePermissions}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;take-ownership&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;full-control&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{TakeOwnership}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;synchronize&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;full-control&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{Synchronize}</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">translate_granular_perms</span></span><span class="token punctuation">(</span>access_type<span class="token punctuation">)</span>
      <span class="token keyword">case</span> access_type
      <span class="token keyword">when</span> <span class="token string">&quot;write-data&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create-files&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;write&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{WriteData CreateFiles}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;append-data&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create-directories&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;write&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{CreateDirectories AppendData}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;write-extended-attributes&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;write&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{WriteExtendedAttributes}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;write-attributes&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;write&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{WriteAttributes}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;read-data&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list-directory&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{ReadData ListDirectory}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;read-attributes&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{ReadAttributes}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;read-extended-attributes&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{ReadExtendedAttributes}</span>
      <span class="token keyword">when</span> <span class="token string">&quot;read-permissions&quot;</span>
        translate_perm_names<span class="token punctuation">(</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">%w{ReadPermissions}</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br></div></div><h3 id="_8-3-directory"><a href="#_8-3-directory" aria-hidden="true" class="header-anchor">#</a> 8.3. Directory</h3> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">require</span> <span class="token string">&quot;inspec/resources/file&quot;</span>

<span class="token keyword">module</span> <span class="token constant">Inspec</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Resources</span>
  <span class="token keyword">class</span> <span class="token class-name">Directory</span> <span class="token operator">&lt;</span> <span class="token constant">FileResource</span>
    name <span class="token string">&quot;directory&quot;</span>
    supports platform<span class="token punctuation">:</span> <span class="token string">&quot;unix&quot;</span>
    supports platform<span class="token punctuation">:</span> <span class="token string">&quot;windows&quot;</span>
    desc <span class="token string">&quot;Use the directory InSpec audit resource to test if the file type is a directory. This is equivalent to using the file InSpec audit resource and the be_directory matcher, but provides a simpler and more direct way to test directories. All of the matchers available to file may be used with directory.&quot;</span>
    example <span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">~</span><span class="token constant">EXAMPLE</span>
      describe directory<span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
        it <span class="token punctuation">{</span> should be_directory <span class="token punctuation">}</span>
      <span class="token keyword">end</span>
    <span class="token constant">EXAMPLE</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">exist</span></span><span class="token operator">?</span>
      file<span class="token punctuation">.</span>exist<span class="token operator">?</span> <span class="token operator">&amp;&amp;</span> file<span class="token punctuation">.</span>directory<span class="token operator">?</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">to_s</span></span>
      <span class="token string">&quot;Directory <span class="token interpolation"><span class="token delimiter tag">#{</span>source_path<span class="token delimiter tag">}</span></span>&quot;</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_8-4-command"><a href="#_8-4-command" aria-hidden="true" class="header-anchor">#</a> 8.4. command</h3> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># copyright: 2015, Vulcano Security GmbH</span>

<span class="token keyword">require</span> <span class="token string">&quot;inspec/resource&quot;</span>

<span class="token keyword">module</span> <span class="token constant">Inspec</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Resources</span>
  <span class="token keyword">class</span> <span class="token class-name">Cmd</span> <span class="token operator">&lt;</span> <span class="token constant">Inspec</span><span class="token punctuation">.</span>resource<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    name <span class="token string">&quot;command&quot;</span>
    supports platform<span class="token punctuation">:</span> <span class="token string">&quot;unix&quot;</span>
    supports platform<span class="token punctuation">:</span> <span class="token string">&quot;windows&quot;</span>
    desc <span class="token string">&quot;Use the command InSpec audit resource to test an arbitrary command that is run on the system.&quot;</span>
    example <span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">~</span><span class="token constant">EXAMPLE</span>
      describe command<span class="token punctuation">(</span><span class="token string">'ls -al /'</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
        its<span class="token punctuation">(</span><span class="token string">'stdout'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should match <span class="token regex">/bin/</span> <span class="token punctuation">}</span>
        its<span class="token punctuation">(</span><span class="token string">'stderr'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should eq <span class="token string">''</span> <span class="token punctuation">}</span>
        its<span class="token punctuation">(</span><span class="token string">'exit_status'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should eq <span class="token number">0</span> <span class="token punctuation">}</span>
      <span class="token keyword">end</span>

      command<span class="token punctuation">(</span><span class="token string">'ls -al /'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exist<span class="token operator">?</span> will <span class="token keyword">return</span> <span class="token keyword">false</span><span class="token punctuation">.</span> <span class="token constant">Existence</span> of command should be checked this way<span class="token punctuation">.</span>
      describe command<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
        it <span class="token punctuation">{</span> should exist <span class="token punctuation">}</span>
      <span class="token keyword">end</span>
    <span class="token constant">EXAMPLE</span>

    attr_reader <span class="token symbol">:command</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> cmd<span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>
        <span class="token keyword">raise</span> <span class="token string">&quot;InSpec `command` was called with `nil` as the argument. This is not supported. Please provide a valid command instead.&quot;</span>
      <span class="token keyword">end</span>

      <span class="token variable">@command</span> <span class="token operator">=</span> cmd

      <span class="token keyword">if</span> options<span class="token punctuation">[</span><span class="token symbol">:redact_regex</span><span class="token punctuation">]</span>
        <span class="token keyword">unless</span> options<span class="token punctuation">[</span><span class="token symbol">:redact_regex</span><span class="token punctuation">]</span><span class="token punctuation">.</span>is_a<span class="token operator">?</span><span class="token punctuation">(</span><span class="token builtin">Regexp</span><span class="token punctuation">)</span>
          <span class="token comment"># Make sure command is replaced so sensitive output isn't shown</span>
          <span class="token variable">@command</span> <span class="token operator">=</span> <span class="token string">&quot;ERROR&quot;</span>
          <span class="token keyword">raise</span> <span class="token constant">Inspec</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Exceptions</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ResourceFailed</span><span class="token punctuation">,</span>
            <span class="token string">&quot;The `redact_regex` option must be a regular expression&quot;</span>
        <span class="token keyword">end</span>
        <span class="token variable">@redact_regex</span> <span class="token operator">=</span> options<span class="token punctuation">[</span><span class="token symbol">:redact_regex</span><span class="token punctuation">]</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">result</span></span>
      <span class="token variable">@result</span> <span class="token operator">||</span><span class="token operator">=</span> inspec<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>run_command<span class="token punctuation">(</span><span class="token variable">@command</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">stdout</span></span>
      result<span class="token punctuation">.</span>stdout
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">stderr</span></span>
      result<span class="token punctuation">.</span>stderr
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">exit_status</span></span>
      result<span class="token punctuation">.</span>exit_status<span class="token punctuation">.</span>to_i
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">exist</span></span><span class="token operator">?</span> <span class="token comment"># rubocop:disable Metrics/AbcSize</span>
      <span class="token comment"># silent for mock resources</span>
      <span class="token keyword">return</span> <span class="token keyword">false</span> <span class="token keyword">if</span> inspec<span class="token punctuation">.</span>os<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span> <span class="token operator">||</span> inspec<span class="token punctuation">.</span>os<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;mock&quot;</span>

      <span class="token keyword">if</span> inspec<span class="token punctuation">.</span>os<span class="token punctuation">.</span>linux<span class="token operator">?</span>
        res <span class="token operator">=</span> <span class="token keyword">if</span> inspec<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;alpine&quot;</span>
                inspec<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>run_command<span class="token punctuation">(</span><span class="token string">&quot;which \&quot;<span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token variable">@command</span><span class="token delimiter tag">}</span></span>\&quot;&quot;</span><span class="token punctuation">)</span>
              <span class="token keyword">else</span>
                inspec<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>run_command<span class="token punctuation">(</span><span class="token string">&quot;bash -c 'type \&quot;<span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token variable">@command</span><span class="token delimiter tag">}</span></span>\&quot;'&quot;</span><span class="token punctuation">)</span>
              <span class="token keyword">end</span>
      <span class="token keyword">elsif</span> inspec<span class="token punctuation">.</span>os<span class="token punctuation">.</span>windows<span class="token operator">?</span>
        res <span class="token operator">=</span> inspec<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>run_command<span class="token punctuation">(</span><span class="token string">&quot;Get-Command \&quot;<span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token variable">@command</span><span class="token delimiter tag">}</span></span>\&quot;&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">elsif</span> inspec<span class="token punctuation">.</span>os<span class="token punctuation">.</span>unix<span class="token operator">?</span>
        res <span class="token operator">=</span> inspec<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>run_command<span class="token punctuation">(</span><span class="token string">&quot;type \&quot;<span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token variable">@command</span><span class="token delimiter tag">}</span></span>\&quot;&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">else</span>
        warn <span class="token string">&quot;`command(<span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token variable">@command</span><span class="token delimiter tag">}</span></span>).exist?` is not supported on your OS: <span class="token interpolation"><span class="token delimiter tag">#{</span>inspec<span class="token punctuation">.</span>os<span class="token punctuation">[</span><span class="token symbol">:name</span><span class="token punctuation">]</span><span class="token delimiter tag">}</span></span>&quot;</span>
        <span class="token keyword">return</span> <span class="token keyword">false</span>
      <span class="token keyword">end</span>
      res<span class="token punctuation">.</span>exit_status<span class="token punctuation">.</span>to_i <span class="token operator">==</span> <span class="token number">0</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">to_s</span></span>
      output <span class="token operator">=</span> <span class="token string">&quot;Command: `<span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token variable">@command</span><span class="token delimiter tag">}</span></span>`&quot;</span>
      <span class="token comment"># Redact output if the `redact_regex` option is passed</span>
      <span class="token comment"># If no capture groups are passed then `\1` and `\2` are ignored</span>
      output<span class="token punctuation">.</span>gsub<span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">@redact_regex</span><span class="token punctuation">,</span> <span class="token string">'\1REDACTED\2'</span><span class="token punctuation">)</span> <span class="token keyword">unless</span> <span class="token variable">@redact_regex</span><span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>
      output
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br></div></div><h3 id="_8-5-docker"><a href="#_8-5-docker" aria-hidden="true" class="header-anchor">#</a> 8.5. Docker</h3> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment">#</span>
<span class="token comment"># Copyright 2017, Christoph Hartmann</span>
<span class="token comment">#</span>

<span class="token keyword">require</span> <span class="token string">&quot;inspec/resources/command&quot;</span>
<span class="token keyword">require</span> <span class="token string">&quot;inspec/utils/filter&quot;</span>
<span class="token keyword">require</span> <span class="token string">&quot;hashie/mash&quot;</span>

<span class="token keyword">module</span> <span class="token constant">Inspec</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Resources</span>
  <span class="token keyword">class</span> <span class="token class-name">DockerContainerFilter</span>
    <span class="token comment"># use filtertable for containers</span>
    filter <span class="token operator">=</span> <span class="token constant">FilterTable</span><span class="token punctuation">.</span>create
    filter<span class="token punctuation">.</span>register_custom_matcher<span class="token punctuation">(</span><span class="token symbol">:exists?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">|</span>x<span class="token operator">|</span> <span class="token operator">!</span>x<span class="token punctuation">.</span>entries<span class="token punctuation">.</span>empty<span class="token operator">?</span> <span class="token punctuation">}</span>
    filter<span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:commands</span><span class="token punctuation">,</span> field<span class="token punctuation">:</span> <span class="token string">&quot;command&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:ids</span><span class="token punctuation">,</span>            field<span class="token punctuation">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:images</span><span class="token punctuation">,</span>         field<span class="token punctuation">:</span> <span class="token string">&quot;image&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:labels</span><span class="token punctuation">,</span>         field<span class="token punctuation">:</span> <span class="token string">&quot;labels&quot;</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token symbol">:simple</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:local_volumes</span><span class="token punctuation">,</span>  field<span class="token punctuation">:</span> <span class="token string">&quot;localvolumes&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:mounts</span><span class="token punctuation">,</span>         field<span class="token punctuation">:</span> <span class="token string">&quot;mounts&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:names</span><span class="token punctuation">,</span>          field<span class="token punctuation">:</span> <span class="token string">&quot;names&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:networks</span><span class="token punctuation">,</span>       field<span class="token punctuation">:</span> <span class="token string">&quot;networks&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:ports</span><span class="token punctuation">,</span>          field<span class="token punctuation">:</span> <span class="token string">&quot;ports&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:running_for</span><span class="token punctuation">,</span>    field<span class="token punctuation">:</span> <span class="token string">&quot;runningfor&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:sizes</span><span class="token punctuation">,</span>          field<span class="token punctuation">:</span> <span class="token string">&quot;size&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:status</span><span class="token punctuation">,</span>         field<span class="token punctuation">:</span> <span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_custom_matcher<span class="token punctuation">(</span><span class="token symbol">:running?</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>x<span class="token operator">|</span>
        x<span class="token punctuation">.</span>where <span class="token punctuation">{</span> status<span class="token punctuation">.</span>downcase<span class="token punctuation">.</span>start_with<span class="token operator">?</span><span class="token punctuation">(</span><span class="token string">&quot;up&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
      <span class="token keyword">end</span>
    filter<span class="token punctuation">.</span>install_filter_methods_on_resource<span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token symbol">:containers</span><span class="token punctuation">)</span>

    attr_reader <span class="token symbol">:containers</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>containers<span class="token punctuation">)</span>
      <span class="token variable">@containers</span> <span class="token operator">=</span> containers
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  <span class="token keyword">class</span> <span class="token class-name">DockerImageFilter</span>
    filter <span class="token operator">=</span> <span class="token constant">FilterTable</span><span class="token punctuation">.</span>create
    filter<span class="token punctuation">.</span>register_custom_matcher<span class="token punctuation">(</span><span class="token symbol">:exists?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">|</span>x<span class="token operator">|</span> <span class="token operator">!</span>x<span class="token punctuation">.</span>entries<span class="token punctuation">.</span>empty<span class="token operator">?</span> <span class="token punctuation">}</span>
    filter<span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:ids</span><span class="token punctuation">,</span> field<span class="token punctuation">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:repositories</span><span class="token punctuation">,</span>  field<span class="token punctuation">:</span> <span class="token string">&quot;repository&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:tags</span><span class="token punctuation">,</span>          field<span class="token punctuation">:</span> <span class="token string">&quot;tag&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:sizes</span><span class="token punctuation">,</span>         field<span class="token punctuation">:</span> <span class="token string">&quot;size&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:digests</span><span class="token punctuation">,</span>       field<span class="token punctuation">:</span> <span class="token string">&quot;digest&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:created</span><span class="token punctuation">,</span>       field<span class="token punctuation">:</span> <span class="token string">&quot;createdat&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:created_since</span><span class="token punctuation">,</span> field<span class="token punctuation">:</span> <span class="token string">&quot;createdsize&quot;</span><span class="token punctuation">)</span>
    filter<span class="token punctuation">.</span>install_filter_methods_on_resource<span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token symbol">:images</span><span class="token punctuation">)</span>

    attr_reader <span class="token symbol">:images</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>images<span class="token punctuation">)</span>
      <span class="token variable">@images</span> <span class="token operator">=</span> images
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  <span class="token keyword">class</span> <span class="token class-name">DockerPluginFilter</span>
    filter <span class="token operator">=</span> <span class="token constant">FilterTable</span><span class="token punctuation">.</span>create
    filter<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token symbol">:ids</span><span class="token punctuation">,</span> field<span class="token punctuation">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token symbol">:names</span><span class="token punctuation">,</span>    field<span class="token punctuation">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token symbol">:versions</span><span class="token punctuation">,</span> field<span class="token punctuation">:</span> <span class="token string">&quot;version&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token symbol">:enabled</span><span class="token punctuation">,</span>  field<span class="token punctuation">:</span> <span class="token string">&quot;enabled&quot;</span><span class="token punctuation">)</span>
    filter<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token symbol">:plugins</span><span class="token punctuation">)</span>

    attr_reader <span class="token symbol">:plugins</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>plugins<span class="token punctuation">)</span>
      <span class="token variable">@plugins</span> <span class="token operator">=</span> plugins
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  <span class="token keyword">class</span> <span class="token class-name">DockerServiceFilter</span>
    filter <span class="token operator">=</span> <span class="token constant">FilterTable</span><span class="token punctuation">.</span>create
    filter<span class="token punctuation">.</span>register_custom_matcher<span class="token punctuation">(</span><span class="token symbol">:exists?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">|</span>x<span class="token operator">|</span> <span class="token operator">!</span>x<span class="token punctuation">.</span>entries<span class="token punctuation">.</span>empty<span class="token operator">?</span> <span class="token punctuation">}</span>
    filter<span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:ids</span><span class="token punctuation">,</span> field<span class="token punctuation">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:names</span><span class="token punctuation">,</span>    field<span class="token punctuation">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:modes</span><span class="token punctuation">,</span>    field<span class="token punctuation">:</span> <span class="token string">&quot;mode&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:replicas</span><span class="token punctuation">,</span> field<span class="token punctuation">:</span> <span class="token string">&quot;replicas&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:images</span><span class="token punctuation">,</span>   field<span class="token punctuation">:</span> <span class="token string">&quot;image&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>register_column<span class="token punctuation">(</span><span class="token symbol">:ports</span><span class="token punctuation">,</span>    field<span class="token punctuation">:</span> <span class="token string">&quot;ports&quot;</span><span class="token punctuation">)</span>
    filter<span class="token punctuation">.</span>install_filter_methods_on_resource<span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token symbol">:services</span><span class="token punctuation">)</span>

    attr_reader <span class="token symbol">:services</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>services<span class="token punctuation">)</span>
      <span class="token variable">@services</span> <span class="token operator">=</span> services
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  <span class="token comment"># This resource helps to parse information from the docker host</span>
  <span class="token comment"># For compatability with Serverspec we also offer the following resouses:</span>
  <span class="token comment"># - docker_container</span>
  <span class="token comment"># - docker_image</span>
  <span class="token keyword">class</span> <span class="token class-name">Docker</span> <span class="token operator">&lt;</span> <span class="token constant">Inspec</span><span class="token punctuation">.</span>resource<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    name <span class="token string">&quot;docker&quot;</span>
    supports platform<span class="token punctuation">:</span> <span class="token string">&quot;unix&quot;</span>
    desc &quot;
      <span class="token constant">A</span> resource to retrieve information about docker
    &quot;

    example <span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">~</span><span class="token constant">EXAMPLE</span>
      describe docker<span class="token punctuation">.</span>containers <span class="token keyword">do</span>
        its<span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should_not include <span class="token string">'u12:latest'</span> <span class="token punctuation">}</span>
      <span class="token keyword">end</span>

      describe docker<span class="token punctuation">.</span>images <span class="token keyword">do</span>
        its<span class="token punctuation">(</span><span class="token string">'repositories'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should_not include <span class="token string">'inssecure_image'</span> <span class="token punctuation">}</span>
      <span class="token keyword">end</span>

      describe docker<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>where <span class="token punctuation">{</span> name <span class="token operator">==</span> <span class="token string">'rexray/ebs'</span> <span class="token punctuation">}</span> <span class="token keyword">do</span>
        it <span class="token punctuation">{</span> should exist <span class="token punctuation">}</span>
      <span class="token keyword">end</span>

      describe docker<span class="token punctuation">.</span>services <span class="token keyword">do</span>
        its<span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should_not include <span class="token string">'inssecure_image'</span> <span class="token punctuation">}</span>
      <span class="token keyword">end</span>

      describe docker<span class="token punctuation">.</span>version <span class="token keyword">do</span>
        its<span class="token punctuation">(</span><span class="token string">'Server.Version'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should cmp <span class="token operator">&gt;=</span> <span class="token string">'1.12'</span><span class="token punctuation">}</span>
        its<span class="token punctuation">(</span><span class="token string">'Client.Version'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should cmp <span class="token operator">&gt;=</span> <span class="token string">'1.12'</span><span class="token punctuation">}</span>
      <span class="token keyword">end</span>

      describe docker<span class="token punctuation">.</span>object<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">do</span>
        its<span class="token punctuation">(</span><span class="token string">'Configuration.Path'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should eq <span class="token string">'value'</span> <span class="token punctuation">}</span>
      <span class="token keyword">end</span>

      docker<span class="token punctuation">.</span>containers<span class="token punctuation">.</span>ids<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>id<span class="token operator">|</span>
        <span class="token comment"># call docker inspect for a specific container id</span>
        describe docker<span class="token punctuation">.</span>object<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">do</span>
          its<span class="token punctuation">(</span><span class="token string">%w(HostConfig Privileged)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should cmp <span class="token keyword">false</span> <span class="token punctuation">}</span>
          its<span class="token punctuation">(</span><span class="token string">%w(HostConfig Privileged)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should_not cmp <span class="token keyword">true</span> <span class="token punctuation">}</span>
        <span class="token keyword">end</span>
      <span class="token keyword">end</span>
    <span class="token constant">EXAMPLE</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">containers</span></span>
      <span class="token constant">DockerContainerFilter</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>parse_containers<span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">images</span></span>
      <span class="token constant">DockerImageFilter</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>parse_images<span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">plugins</span></span>
      <span class="token constant">DockerPluginFilter</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>parse_plugins<span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">services</span></span>
      <span class="token constant">DockerServiceFilter</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>parse_services<span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">version</span></span>
      <span class="token keyword">return</span> <span class="token variable">@version</span> <span class="token keyword">if</span> <span class="token keyword">defined</span><span class="token operator">?</span><span class="token punctuation">(</span><span class="token variable">@version</span><span class="token punctuation">)</span>

      data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      cmd <span class="token operator">=</span> inspec<span class="token punctuation">.</span>command<span class="token punctuation">(</span><span class="token string">&quot;docker version --format '{{ json . }}'&quot;</span><span class="token punctuation">)</span>
      data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>cmd<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span> <span class="token keyword">if</span> cmd<span class="token punctuation">.</span>exit_status <span class="token operator">==</span> <span class="token number">0</span>
      <span class="token variable">@version</span> <span class="token operator">=</span> <span class="token constant">Hashie</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Mash</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">rescue</span> <span class="token constant">JSON</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ParserError</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _e
      <span class="token constant">Hashie</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Mash</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">info</span></span>
      <span class="token keyword">return</span> <span class="token variable">@info</span> <span class="token keyword">if</span> <span class="token keyword">defined</span><span class="token operator">?</span><span class="token punctuation">(</span><span class="token variable">@info</span><span class="token punctuation">)</span>

      data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token comment"># docke info format is only supported for Docker 17.03+</span>
      cmd <span class="token operator">=</span> inspec<span class="token punctuation">.</span>command<span class="token punctuation">(</span><span class="token string">&quot;docker info --format '{{ json . }}'&quot;</span><span class="token punctuation">)</span>
      data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>cmd<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span> <span class="token keyword">if</span> cmd<span class="token punctuation">.</span>exit_status <span class="token operator">==</span> <span class="token number">0</span>
      <span class="token variable">@info</span> <span class="token operator">=</span> <span class="token constant">Hashie</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Mash</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">rescue</span> <span class="token constant">JSON</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ParserError</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _e
      <span class="token constant">Hashie</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Mash</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token comment"># returns information about docker objects</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">object</span></span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token variable">@inspect</span> <span class="token keyword">if</span> <span class="token keyword">defined</span><span class="token operator">?</span><span class="token punctuation">(</span><span class="token variable">@inspect</span><span class="token punctuation">)</span>

      data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>inspec<span class="token punctuation">.</span>command<span class="token punctuation">(</span><span class="token string">&quot;docker inspect <span class="token interpolation"><span class="token delimiter tag">#{</span>id<span class="token delimiter tag">}</span></span>&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
      data <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> data<span class="token punctuation">.</span>is_a<span class="token operator">?</span><span class="token punctuation">(</span><span class="token builtin">Array</span><span class="token punctuation">)</span>
      <span class="token variable">@inspect</span> <span class="token operator">=</span> <span class="token constant">Hashie</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Mash</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">rescue</span> <span class="token constant">JSON</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ParserError</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _e
      <span class="token constant">Hashie</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Mash</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">to_s</span></span>
      <span class="token string">&quot;Docker Host&quot;</span>
    <span class="token keyword">end</span>

    <span class="token keyword">private</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">parse_json_command</span></span><span class="token punctuation">(</span>labels<span class="token punctuation">,</span> subcommand<span class="token punctuation">)</span>
      <span class="token comment"># build command</span>
      format <span class="token operator">=</span> labels<span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token operator">|</span>label<span class="token operator">|</span> <span class="token string">&quot;\&quot;<span class="token interpolation"><span class="token delimiter tag">#{</span>label<span class="token delimiter tag">}</span></span>\&quot;: {{json .<span class="token interpolation"><span class="token delimiter tag">#{</span>label<span class="token delimiter tag">}</span></span>}}&quot;</span> <span class="token punctuation">}</span>
      raw <span class="token operator">=</span> inspec<span class="token punctuation">.</span>command<span class="token punctuation">(</span><span class="token string">&quot;docker <span class="token interpolation"><span class="token delimiter tag">#{</span>subcommand<span class="token delimiter tag">}</span></span> --format '{<span class="token interpolation"><span class="token delimiter tag">#{</span>format<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span><span class="token delimiter tag">}</span></span>}'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout
      output <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token comment"># since docker is not outputting valid json, we need to parse each row</span>
      raw<span class="token punctuation">.</span>each_line <span class="token keyword">do</span> <span class="token operator">|</span>entry<span class="token operator">|</span>
        <span class="token comment"># convert all keys to lower_case to work well with ruby and filter table</span>
        row <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span>map <span class="token keyword">do</span> <span class="token operator">|</span>key<span class="token punctuation">,</span> value<span class="token operator">|</span>
          <span class="token punctuation">[</span>key<span class="token punctuation">.</span>downcase<span class="token punctuation">,</span> value<span class="token punctuation">]</span>
        <span class="token keyword">end</span><span class="token punctuation">.</span>to_h

        <span class="token comment"># ensure all keys are there</span>
        row <span class="token operator">=</span> ensure_keys<span class="token punctuation">(</span>row<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>

        <span class="token comment"># strip off any linked container names</span>
        <span class="token comment"># Depending on how it was linked, the actual container name may come before</span>
        <span class="token comment"># or after the link information, so we'll just look for the first name that</span>
        <span class="token comment"># does not include a slash since that is not a valid character in a container name</span>
        <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">&quot;names&quot;</span><span class="token punctuation">]</span>
          row<span class="token punctuation">[</span><span class="token string">&quot;names&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token string">&quot;names&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find <span class="token punctuation">{</span> <span class="token operator">|</span>c<span class="token operator">|</span> <span class="token operator">!</span>c<span class="token punctuation">.</span>include<span class="token operator">?</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token keyword">end</span>

        <span class="token comment"># Split labels on ',' or set to empty array</span>
        <span class="token comment"># Allows for `docker.containers.where { labels.include?('app=redis') }`</span>
        row<span class="token punctuation">[</span><span class="token string">&quot;labels&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> row<span class="token punctuation">.</span>key<span class="token operator">?</span><span class="token punctuation">(</span><span class="token string">&quot;labels&quot;</span><span class="token punctuation">)</span> <span class="token operator">?</span> row<span class="token punctuation">[</span><span class="token string">&quot;labels&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        output<span class="token punctuation">.</span>push<span class="token punctuation">(</span>row<span class="token punctuation">)</span>
      <span class="token keyword">end</span>

      output
    <span class="token keyword">rescue</span> <span class="token constant">JSON</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ParserError</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _e
      warn <span class="token string">&quot;Could not parse `docker <span class="token interpolation"><span class="token delimiter tag">#{</span>subcommand<span class="token delimiter tag">}</span></span>` output&quot;</span>
      <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">parse_containers</span></span>
      <span class="token comment"># @see https://github.com/moby/moby/issues/20625, works for docker 1.13+</span>
      <span class="token comment"># raw_containers = inspec.command('docker ps -a --no-trunc --format \'{{ json . }}\'').stdout</span>
      <span class="token comment"># therefore we stick with older approach</span>
      labels <span class="token operator">=</span> <span class="token string">%w{Command CreatedAt ID Image Labels Mounts Names Ports RunningFor Size Status}</span>

      <span class="token comment"># Networks LocalVolumes work with 1.13+ only</span>
      <span class="token keyword">if</span> <span class="token operator">!</span>version<span class="token punctuation">.</span>empty<span class="token operator">?</span> <span class="token operator">&amp;&amp;</span> <span class="token constant">Gem</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Version</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>version<span class="token punctuation">[</span><span class="token string">&quot;Client&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;Version&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token constant">Gem</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Version</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">&quot;1.13&quot;</span><span class="token punctuation">)</span>
        labels<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token string">&quot;Networks&quot;</span><span class="token punctuation">)</span>
        labels<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token string">&quot;LocalVolumes&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">end</span>
      parse_json_command<span class="token punctuation">(</span>labels<span class="token punctuation">,</span> <span class="token string">&quot;ps -a --no-trunc&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">parse_services</span></span>
      parse_json_command<span class="token punctuation">(</span><span class="token string">%w{ID Name Mode Replicas Image Ports}</span><span class="token punctuation">,</span> <span class="token string">&quot;service ls&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">ensure_keys</span></span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>
      labels<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>key<span class="token operator">|</span>
        entry<span class="token punctuation">[</span>key<span class="token punctuation">.</span>downcase<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span> <span class="token keyword">unless</span> entry<span class="token punctuation">.</span>key<span class="token operator">?</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span>downcase<span class="token punctuation">)</span>
      <span class="token keyword">end</span>
      entry
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">parse_images</span></span>
      <span class="token comment"># docker does not support the `json .` function here, therefore we need to emulate that behavior.</span>
      raw_images <span class="token operator">=</span> inspec<span class="token punctuation">.</span>command<span class="token punctuation">(</span><span class="token string">'docker images -a --no-trunc --format \'{ &quot;id&quot;: {{json .ID}}, &quot;repository&quot;: {{json .Repository}}, &quot;tag&quot;: {{json .Tag}}, &quot;size&quot;: {{json .Size}}, &quot;digest&quot;: {{json .Digest}}, &quot;createdat&quot;: {{json .CreatedAt}}, &quot;createdsize&quot;: {{json .CreatedSince}} }\''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout
      c_images <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      raw_images<span class="token punctuation">.</span>each_line <span class="token keyword">do</span> <span class="token operator">|</span>entry<span class="token operator">|</span>
        c_images<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">end</span>
      c_images
    <span class="token keyword">rescue</span> <span class="token constant">JSON</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ParserError</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _e
      warn <span class="token string">&quot;Could not parse `docker images` output&quot;</span>
      <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">parse_plugins</span></span>
      plugins <span class="token operator">=</span> inspec<span class="token punctuation">.</span>command<span class="token punctuation">(</span><span class="token string">'docker plugin ls --format \'{&quot;id&quot;: {{json .ID}}, &quot;name&quot;: &quot;{{ with split .Name &quot;:&quot;}}{{index . 0}}{{end}}&quot;, &quot;version&quot;: &quot;{{ with split .Name &quot;:&quot;}}{{index . 1}}{{end}}&quot;, &quot;enabled&quot;: {{json .Enabled}} }\''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout
      c_plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      plugins<span class="token punctuation">.</span>each_line <span class="token keyword">do</span> <span class="token operator">|</span>entry<span class="token operator">|</span>
        c_plugins<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">end</span>
      c_plugins
    <span class="token keyword">rescue</span> <span class="token constant">JSON</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ParserError</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _e
      warn <span class="token string">&quot;Could not parse `docker plugin ls` output&quot;</span>
      <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br></div></div><h2 id="_9-profile-resource-exercise"><a href="#_9-profile-resource-exercise" aria-hidden="true" class="header-anchor">#</a> 9. Profile &amp; Resource exercise</h2> <h3 id="_9-1-create-new-profile"><a href="#_9-1-create-new-profile" aria-hidden="true" class="header-anchor">#</a> 9.1. Create new profile</h3> <p>Let's start by creating a new profile:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>inspec init profile <span class="token function">git</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_9-2-develop-controls-to-test-run-controls"><a href="#_9-2-develop-controls-to-test-run-controls" aria-hidden="true" class="header-anchor">#</a> 9.2. Develop controls to test / run controls</h3> <p>Now lets write some controls and test that they run:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># encoding: utf-8</span>
<span class="token comment"># copyright: 2018, The Authors</span>

git_dir <span class="token operator">=</span> <span class="token string">&quot;/home/chef/apache/.git&quot;</span>

<span class="token comment"># The following banches should exist</span>
describe command<span class="token punctuation">(</span><span class="token string">&quot;git --git-dir <span class="token interpolation"><span class="token delimiter tag">#{</span>git_dir<span class="token delimiter tag">}</span></span> branch&quot;</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
  its<span class="token punctuation">(</span><span class="token string">'stdout'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should match <span class="token regex">/master/</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>

describe command<span class="token punctuation">(</span><span class="token string">&quot;git --git-dir <span class="token interpolation"><span class="token delimiter tag">#{</span>git_dir<span class="token delimiter tag">}</span></span> branch&quot;</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
  its<span class="token punctuation">(</span><span class="token string">'stdout'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should match <span class="token regex">/testBranch/</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>

<span class="token comment"># What is the current branch</span>
describe command<span class="token punctuation">(</span><span class="token string">&quot;git --git-dir <span class="token interpolation"><span class="token delimiter tag">#{</span>git_dir<span class="token delimiter tag">}</span></span> branch&quot;</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
  its<span class="token punctuation">(</span><span class="token string">'stdout'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should match <span class="token regex">/^\* master/</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>

<span class="token comment"># What is the latest commit</span>
describe command<span class="token punctuation">(</span><span class="token string">&quot;git --git-dir <span class="token interpolation"><span class="token delimiter tag">#{</span>git_dir<span class="token delimiter tag">}</span></span> log -1 --pretty=format:'%h'&quot;</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
  its<span class="token punctuation">(</span><span class="token string">'stdout'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should match <span class="token regex">/48bf020/</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>

<span class="token comment"># What is the second to last commit</span>
describe command<span class="token punctuation">(</span><span class="token string">&quot;git --git-dir <span class="token interpolation"><span class="token delimiter tag">#{</span>git_dir<span class="token delimiter tag">}</span></span> log --skip=1 -1 --pretty=format:'%h'&quot;</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
  its<span class="token punctuation">(</span><span class="token string">'stdout'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should match <span class="token regex">/09e9064/</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="_10-develop-resources-to-take-over-above-controls"><a href="#_10-develop-resources-to-take-over-above-controls" aria-hidden="true" class="header-anchor">#</a> 10. Develop resources to take over above controls</h2> <h3 id="_10-1-rewrite-first-test"><a href="#_10-1-rewrite-first-test" aria-hidden="true" class="header-anchor">#</a> 10.1. Rewrite first test</h3> <p>Let's rewrite the first test in our example file as follows:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># The following banches should exist</span>
describe git<span class="token punctuation">(</span>git_dir<span class="token punctuation">)</span> <span class="token keyword">do</span>
  its<span class="token punctuation">(</span><span class="token string">'branches'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should include <span class="token string">'master'</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Now let's run the profile</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>inspec <span class="token function">exec</span> <span class="token function">git</span> -t ssh://
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>We should get an error because the git method and resource are not defined yet</p> <h3 id="_10-2-develop-git-resources"><a href="#_10-2-develop-git-resources" aria-hidden="true" class="header-anchor">#</a> 10.2. Develop git resources</h3> <p>Let's start by creating a new file called git.rb in the libraries directory, the content of the file should look like this:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># encoding: utf-8</span>
<span class="token comment"># copyright: 2018, The Authors</span>

<span class="token keyword">class</span> <span class="token class-name">Git</span> <span class="token operator">&lt;</span> <span class="token constant">Inspec</span><span class="token punctuation">.</span>resource<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    name <span class="token string">'git'</span>

<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Now run the profile again</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>inspec <span class="token function">exec</span> <span class="token function">git</span> -t ssh://
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This time we get another error letting us know that we have a resource that has been given the incorrect number of arguments. This means we have given an additional parameter to this resource that we have not yet accepted.</p> <p>Each resource will require an initialization method.</p> <p>For our git.rb file lets add that initialization method:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># encoding: utf-8</span>
<span class="token comment"># copyright: 2018, The Authors</span>

<span class="token keyword">class</span> <span class="token class-name">Git</span> <span class="token operator">&lt;</span> <span class="token constant">Inspec</span><span class="token punctuation">.</span>resource<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    name <span class="token string">'git'</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token variable">@path</span> <span class="token operator">=</span> path
    <span class="token keyword">end</span>

<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>This is saving the path we are passing in from the control into an instance method called path.</p> <p>Now when we run the profile</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>inspec <span class="token function">exec</span> <span class="token function">git</span> -t ssh://
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The test will run but we will get an error saying we do not have a &quot;branches&quot; method.</p> <p>So let's go back to our ruby.rb file to fix that as seen below:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># encoding: utf-8</span>
<span class="token comment"># copyright: 2018, The Authors</span>

<span class="token keyword">class</span> <span class="token class-name">Git</span> <span class="token operator">&lt;</span> <span class="token constant">Inspec</span><span class="token punctuation">.</span>resource<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    name <span class="token string">'git'</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token variable">@path</span> <span class="token operator">=</span> path
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">branches</span></span>

    <span class="token keyword">end</span>

<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>At this point all we have done is just define the branches method lets see how the run changes from here</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>inspec <span class="token function">exec</span> <span class="token function">git</span> -t ssh://
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Now the error message says that the branches method is returning a null value when it's expecting an array or something that is able to accept the include method invoked on it</p> <p>We can use the inspec helper method which enables you to invoke any other inspec resource as seen below:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># encoding: utf-8</span>
<span class="token comment"># copyright: 2018, The Authors</span>

<span class="token keyword">class</span> <span class="token class-name">Git</span> <span class="token operator">&lt;</span> <span class="token constant">Inspec</span><span class="token punctuation">.</span>resource<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    name <span class="token string">'git'</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token variable">@path</span> <span class="token operator">=</span> path
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">branches</span></span>
        inspec<span class="token punctuation">.</span>command<span class="token punctuation">(</span><span class="token string">&quot;git --git-dir <span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token variable">@path</span><span class="token delimiter tag">}</span></span> branch&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout
    <span class="token keyword">end</span>

<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Now we see that we get a passing test!</p> <p>Now let's adjust our test to also check for our second branch that we created earlier as well as check our current branch:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># The following banches should exist</span>
describe git<span class="token punctuation">(</span>git_dir<span class="token punctuation">)</span> <span class="token keyword">do</span>
  its<span class="token punctuation">(</span><span class="token string">'branches'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should include <span class="token string">'master'</span> <span class="token punctuation">}</span>
  its<span class="token punctuation">(</span><span class="token string">'branches'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should include <span class="token string">'testBranch'</span> <span class="token punctuation">}</span>
  its<span class="token punctuation">(</span><span class="token string">'current_branch'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should cmp <span class="token string">'master'</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Let's head over to the git.rb file to create the current_branch method we are invoking in the above test:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># encoding: utf-8</span>
<span class="token comment"># copyright: 2018, The Authors</span>

<span class="token keyword">class</span> <span class="token class-name">Git</span> <span class="token operator">&lt;</span> <span class="token constant">Inspec</span><span class="token punctuation">.</span>resource<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    name <span class="token string">'git'</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token variable">@path</span> <span class="token operator">=</span> path
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">branches</span></span>
        inspec<span class="token punctuation">.</span>command<span class="token punctuation">(</span><span class="token string">&quot;git --git-dir <span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token variable">@path</span><span class="token delimiter tag">}</span></span> branch&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">current_branch</span></span>
        branch_name <span class="token operator">=</span> inspec<span class="token punctuation">.</span>command<span class="token punctuation">(</span><span class="token string">&quot;git --git-dir <span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token variable">@path</span><span class="token delimiter tag">}</span></span> branch&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>strip<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find <span class="token keyword">do</span> <span class="token operator">|</span>name<span class="token operator">|</span>
            name<span class="token punctuation">.</span>start_with<span class="token operator">?</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>
        branch_name<span class="token punctuation">.</span>gsub<span class="token punctuation">(</span><span class="token regex">/^\*/</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip
    <span class="token keyword">end</span>

<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>Now we can run the profile again</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>inspec <span class="token function">exec</span> <span class="token function">git</span> -t ssh://
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>All the tests should pass!</p> <p>EXERCISE:<br>
As solo exercise try to create the final method in the git.rb file to check what is the last commit.</p> <h3 id="_10-3-develop-docker-resources"><a href="#_10-3-develop-docker-resources" aria-hidden="true" class="header-anchor">#</a> 10.3. Develop docker resources</h3> <h3 id="_10-4-rewrite-tests-and-run-controls"><a href="#_10-4-rewrite-tests-and-run-controls" aria-hidden="true" class="header-anchor">#</a> 10.4. Rewrite tests and run controls</h3> <h2 id="_11-resource-development-exercise"><a href="#_11-resource-development-exercise" aria-hidden="true" class="header-anchor">#</a> 11. Resource Development exercise</h2> <h3 id="_11-1-what-the-resource-should-do"><a href="#_11-1-what-the-resource-should-do" aria-hidden="true" class="header-anchor">#</a> 11.1. What the resource should do</h3> <ul><li>a</li> <li>b</li> <li>c</li> <li>d</li></ul> <h2 id="_12-day-2-exercise-developing-your-own-resources"><a href="#_12-day-2-exercise-developing-your-own-resources" aria-hidden="true" class="header-anchor">#</a> 12. DAY 2: Exercise developing your own resources.</h2> <ul><li>1
<ul><li>a</li> <li>b</li> <li>c</li></ul></li> <li>2
<ul><li>a</li> <li>b</li> <li>c</li></ul></li> <li>3
<ul><li>a</li> <li>b</li> <li>c</li></ul></li> <li>4
<ul><li>a</li> <li>b</li> <li>c</li></ul></li> <li>5
<ul><li>a</li> <li>b</li> <li>c</li></ul></li></ul> <h2 id="_13-day-3-pushing-your-resource-up-to-inspec"><a href="#_13-day-3-pushing-your-resource-up-to-inspec" aria-hidden="true" class="header-anchor">#</a> 13. DAY 3: Pushing your resource up to inspec</h2> <p>Fork -&gt; Branch -&gt; list directories where changes need to be made.
Go over writing test cases for resource</p> <h2 id="_14-day-3-update-a-few-resources-that-were-previously-built-and-show-the-process-for-moving-that-resource-to-be-put-in-inspec"><a href="#_14-day-3-update-a-few-resources-that-were-previously-built-and-show-the-process-for-moving-that-resource-to-be-put-in-inspec" aria-hidden="true" class="header-anchor">#</a> 14. DAY 3: Update a few resources that were previously built and show the process for moving that resource to be put in inspec</h2> <h2 id="_15-using-what-you-ve-learned"><a href="#_15-using-what-you-ve-learned" aria-hidden="true" class="header-anchor">#</a> 15. Using what you've learned</h2> <p>Now you should be able to</p> <ul><li>Describe the InSpec framework and its capabilities</li> <li>Describe the architecture of an InSpec profile</li> <li>Build an InSpec profile to transform security policy into automated security testing</li> <li>Run an InSpec profile against a component of an application stack</li> <li>View and analyze InSpec results</li> <li>Report results</li></ul> <p>You can contribute to existing profiles that can be found here:<br> <a href="https://github.com/mitre" target="_blank" rel="noopener noreferrer">https://github.com/mitre<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Otherwise you can create your own profiles if they don't exist using the following security guidelines:
<a href="https://iase.disa.mil/stigs/Pages/a-z.aspx" target="_blank" rel="noopener noreferrer">https://iase.disa.mil/stigs/Pages/a-z.aspx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://www.cisecurity.org/cis-benchmarks/" target="_blank" rel="noopener noreferrer">https://www.cisecurity.org/cis-benchmarks/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_16-additional-resources"><a href="#_16-additional-resources" aria-hidden="true" class="header-anchor">#</a> 16. Additional Resources</h2> <h3 id="_16-1-security-guidance"><a href="#_16-1-security-guidance" aria-hidden="true" class="header-anchor">#</a> 16.1 Security Guidance</h3> <p><a href="https://iase.disa.mil/stigs/Pages/a-z.aspx" target="_blank" rel="noopener noreferrer">https://iase.disa.mil/stigs/Pages/a-z.aspx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://www.cisecurity.org/cis-benchmarks/" target="_blank" rel="noopener noreferrer">https://www.cisecurity.org/cis-benchmarks/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_16-2-inspec-documentation"><a href="#_16-2-inspec-documentation" aria-hidden="true" class="header-anchor">#</a> 16.2 InSpec Documentation</h3> <p><a href="https://www.inspec.io/docs/" target="_blank" rel="noopener noreferrer">InSpec Docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://www.inspec.io/docs/reference/profiles/" target="_blank" rel="noopener noreferrer">InSpec Profiles<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://www.inspec.io/docs/reference/resources/" target="_blank" rel="noopener noreferrer">InSpec Resources<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://www.inspec.io/docs/reference/matchers/" target="_blank" rel="noopener noreferrer">InSpec Matchers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://www.inspec.io/docs/reference/shell/" target="_blank" rel="noopener noreferrer">InSpec Shell<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://www.inspec.io/docs/reference/reporters/" target="_blank" rel="noopener noreferrer">InSpec Reporters<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://blog.chef.io/2017/07/06/understanding-inspec-profile-inheritance/" target="_blank" rel="noopener noreferrer">InSpec Profile Inheritance<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_16-3-additional-tutorials"><a href="#_16-3-additional-tutorials" aria-hidden="true" class="header-anchor">#</a> 16.3 Additional Tutorials</h3> <p><a href="https://blog.chef.io/2018/04/03/what-to-expect-when-youre-inspecing/" target="_blank" rel="noopener noreferrer">What to Expect When You’re InSpec’ing<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="http://www.anniehedgie.com/inspec/" target="_blank" rel="noopener noreferrer">Getting started with InSpec - The InSpec basics series<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="http://datatomix.com/?p=236" target="_blank" rel="noopener noreferrer">Windows infrastructure testing using InSpec – Part I<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="http://datatomix.com/?p=238" target="_blank" rel="noopener noreferrer">Windows infrastructure testing using InSpec and Profiles – Part II<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_16-4-mitre-inspec"><a href="#_16-4-mitre-inspec" aria-hidden="true" class="header-anchor">#</a> 16.4 MITRE InSpec</h3> <p><a href="https://github.com/orgs/mitre/teams/inspec/repositories" target="_blank" rel="noopener noreferrer">MITRE InSpec Repositories<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://github.com/mitre/inspec_tools" target="_blank" rel="noopener noreferrer">InSpec Tools<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://mitre.github.io/heimdall-lite/#" target="_blank" rel="noopener noreferrer">Heimdall Lite<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_16-5-rspec-documentation"><a href="#_16-5-rspec-documentation" aria-hidden="true" class="header-anchor">#</a> 16.5. rspec documentation</h3> <p><a href="https://relishapp.com/rspec/rspec-core/docs/subject/explicit-subject" target="_blank" rel="noopener noreferrer">Explicit Subject<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://github.com/rspec/rspec-expectations/blob/master/Should.md" target="_blank" rel="noopener noreferrer">should and should_not<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://relishapp.com/rspec/rspec-expectations/docs/built-in-matchers" target="_blank" rel="noopener noreferrer">Built in matchers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_16-6-slack"><a href="#_16-6-slack" aria-hidden="true" class="header-anchor">#</a> 16.6. Slack</h3> <p><a href="http://community-slack.chef.io/" target="_blank" rel="noopener noreferrer">Chef Slack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/mitre/inspec-advanced-developer/edit/master/docs/README.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.58b316d7.js" defer></script><script src="/assets/js/2.0a3e1e4e.js" defer></script><script src="/assets/js/3.226df228.js" defer></script>
  </body>
</html>
